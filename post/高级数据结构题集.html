<!-- build time:Wed Sep 07 2022 10:36:31 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><link rel="mask-icon" href="/images/logo.svg" color=""><link rel="manifest" href="/images/manifest.json"><meta name="msapplication-config" content="/images/browserconfig.xml"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="il1q90BxSJlkHz0ezs6wuAALE1ljC0BqphuEiVcl41I"><link rel="alternate" type="application/rss+xml" title="Retsa" href="https://asterzc19.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Retsa" href="https://asterzc19.github.io/atom.xml"><link rel="alternate" type="application/json" title="Retsa" href="https://asterzc19.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="æ¨¡æ¿,é¢˜é›†"><link rel="canonical" href="https://asterzc19.github.io/post/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E9%A2%98%E9%9B%86.html"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-162449527-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-162449527-1")</script><title>é«˜çº§æ•°æ®ç»“æ„é¢˜é›† | å›ä¸åˆ°çš„è¿‡å» = Retsa</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">é«˜çº§æ•°æ®ç»“æ„é¢˜é›†</h1><div class="meta"><span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2022-06-09 18:00:20"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">å‘è¡¨äº</span> <time itemprop="dateCreated datePublished" datetime="2022-06-09T18:00:20+08:00">2022-06-09</time> </span><span class="item" title="æœ¬æ–‡å­—æ•°"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">æœ¬æ–‡å­—æ•°</span> <span>52k</span> <span class="text">å­—</span> </span><span class="item" title="é˜…è¯»æ—¶é•¿"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">é˜…è¯»æ—¶é•¿</span> <span>47 åˆ†é’Ÿ</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">å›ä¸åˆ°çš„è¿‡å»</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/07/adf69ad6a75c5594.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/07/372deb0eedb17ea9.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/b545cd4703efa0d4.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/5c235cc1bbf7c128.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/07/6cde4a47e73d00cf.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/05/a67b0e59dd863077.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/05/db894a8df07c1517.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/05/d77d62850e952780.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/c262304a9abc9a8f.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/7f6edf1d98b0d8a0.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/05/848d77945ce37428.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/958c3bf3cd3a0db5.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/2ed81611f053c81c.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/21bbfe021cfceec4.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/0f4de4af64f8d166.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/05/728c619db3847842.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/9259140c0ac4c203.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/05/93a7b0f96c0166ce.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/07/a655408706100f86.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/05/7d78d1f79d9080f1.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/85da8357bdceba73.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/8e1dc72d6a2cd665.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/e82f196e980a63f5.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/17ec9c377d1b2c89.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/07/04b816dd3c5c9934.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/05/34d7d1d1b3b17e24.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/06/2b1d828f5ff26065.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/07/4203257a6c65e036.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/05/44d29b2c5b4e40c8.jpg"></li><li class="item" data-background-image="https://s3.bmp.ovh/imgs/2022/09/05/0ff0506797b60902.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">é¦–é¡µ</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://asterzc19.github.io/post/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E9%A2%98%E9%9B%86.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/iOS.jpg"><meta itemprop="name" content="Retsa"><meta itemprop="description" content=", å¯¹æœªæ¥çš„é€æ”¯ï¼Œå¯¹è¿‡å»çš„å¿è¿˜"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Retsa"></span><div class="body md" itemprop="articleBody"><blockquote><p>åŒ…æ‹¬å¹¶æŸ¥é›†ã€æ ‘çŠ¶æ•°ç»„ã€çº¿æ®µæ ‘ã€å¯æŒä¹…åŒ–æ•°æ®ç»“æ„ã€å¹³è¡¡æ ‘ã€AC è‡ªåŠ¨æœºã€‚<br>å…¶ä½™æ•°æ®ç»“æ„å‚è€ƒè‡ª Pecco ã€OI WIKI ä»¥åŠä»–äººåšå®¢ã€‚</p></blockquote><span id="more"></span><h2 id="å¹¶æŸ¥é›†"><a href="#å¹¶æŸ¥é›†" class="headerlink" title="å¹¶æŸ¥é›†"></a>å¹¶æŸ¥é›†</h2><h3 id="æ ¼å­æ¸¸æˆ"><a href="#æ ¼å­æ¸¸æˆ" class="headerlink" title="æ ¼å­æ¸¸æˆ"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMTI1Mi8=">æ ¼å­æ¸¸æˆ</span></h3><ul><li>åˆ¤æ–­æ˜¯å¦æˆç¯ï¼Œå½“ä¸”ä»…å½“æ–°åŠ å…¥çš„é‚£æ¡è¾¹çš„ä¸¤ä¸ªç«¯ç‚¹éƒ½åœ¨åŒä¸€ä¸ªé›†åˆä¸­ã€‚</li><li>äºŒç»´åæ ‡ $(x, y)$ è½¬æ¢æˆä¸€ç»´åæ ‡ $(x \times n + y)$ ï¼ˆ $x, y$ å‡ä» 0 å¼€å§‹ï¼‰ã€‚</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 40010;
int p[N];
int find(int x)&#123;
    if(p[x] != x) p[x] = find(p[x]);
    return p[x];
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    int n, m, pos = 0;
    cin &gt;&gt; n &gt;&gt; m;
    auto getid = [&amp;](int x, int y)&#123;
        return (x * n + y);
    &#125;;
    for(int i = 0; i &lt; n * n; i++) p[i] = i;   // è½¬æ¢åæ ‡ä» 0 å¼€å§‹
    for(int i = 1; i &lt;= m; i++)&#123;
        int x, y;
        char op;
        cin &gt;&gt; x &gt;&gt; y &gt;&gt; op;
        x--, y--;   // åæ ‡ä» 0 å¼€å§‹
        int a = getid(x, y), b;
        if(op == &#39;R&#39;) b = getid(x, y + 1);
        else b = getid(x + 1, y);
        int pa = find(a), pb = find(b);
        if(pa == pb)&#123;
            pos = i;
            break;
        &#125;
        p[pa] = pb;
    &#125;
    if(!pos) cout &lt;&lt; &quot;draw&quot; &lt;&lt; endl;
    else cout &lt;&lt; pos &lt;&lt; endl;
&#125;
</code></pre><h3 id="æ­é…è´­ä¹°"><a href="#æ­é…è´­ä¹°" class="headerlink" title="æ­é…è´­ä¹°"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMTI1NC8=">æ­é…è´­ä¹°</span></h3><ul><li>ç»´æŠ¤ size çš„å¹¶æŸ¥é›† + 01 èƒŒåŒ…</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 10010;
int p[N], v[N], w[N], dp[N];
int find(int x)&#123;
    if(p[x] != x) p[x] = find(p[x]);
    return p[x];
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    int n, m, c;
    cin &gt;&gt; n &gt;&gt; m &gt;&gt; c;
    for(int i = 1; i &lt;= n; i++)&#123;
        cin &gt;&gt; v[i] &gt;&gt; w[i];
        p[i] = i;
    &#125;
    for(int i = 1; i &lt;= m; i++)&#123;
        int a, b;
        cin &gt;&gt; a &gt;&gt; b;
        int pa = find(a), pb = find(b);
        if(pa != pb)&#123;
            v[pb] += v[pa];
            w[pb] += w[pa];
            p[pa] = pb;
        &#125;
    &#125;
    // 01 èƒŒåŒ…
    for(int i = 1; i &lt;= n; i++)&#123;
        if(p[i] == i)&#123;
            for(int j = c; j &gt;= v[i]; j--)&#123;
                dp[j] = max(dp[j], dp[j - v[i]] + w[i]);
            &#125;
        &#125;
    &#125;
    cout &lt;&lt; dp[c] &lt;&lt; endl;
&#125;
</code></pre><h3 id="ç¨‹åºè‡ªåŠ¨åˆ†æ"><a href="#ç¨‹åºè‡ªåŠ¨åˆ†æ" class="headerlink" title="ç¨‹åºè‡ªåŠ¨åˆ†æ"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjM5Lw==">ç¨‹åºè‡ªåŠ¨åˆ†æ</span></h3><ul><li>ç¦»æ•£åŒ–</li><li>å°†æ‰€æœ‰ç›¸ç­‰çš„æ¡ä»¶åˆå¹¶</li><li>ä¾æ¬¡åˆ¤æ–­æ¯ä¸ªä¸ç›¸ç­‰çš„æ¡ä»¶</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
int p[200010], cnt;
unordered_map&lt;int, int&gt; mp;
struct Query
&#123;
    int x, y, e;
&#125;query[200010];

int find(int x)&#123;
    if(p[x] != x) p[x] = find(p[x]);
    return p[x];
&#125;
int get(int x)&#123;
    if(!mp.count(x)) mp[x] = ++cnt;
    return mp[x];
&#125;
void solve()&#123;
    cnt = 0;
    mp.clear();

    int n;
    cin &gt;&gt; n;
    for(int i = 1; i &lt;= n; i++)&#123;
        int x, y, e;
        cin &gt;&gt; x &gt;&gt; y &gt;&gt; e;
        x = get(x), y = get(y);
        query[i] = &#123;x, y, e&#125;;
    &#125;
    for(int i = 1; i &lt;= cnt; i++) p[i] = i;
    // åˆå¹¶æ‰€æœ‰ç›¸ç­‰çš„
    for(int i = 1; i &lt;= n; i++)&#123;
        if(query[i].e)&#123;
            int pa = find(query[i].x), pb = find(query[i].y);
            p[pa] = pb;
        &#125;
    &#125;
    // æ£€æŸ¥æ‰€æœ‰ä¸ç­‰çš„
    for(int i = 1; i &lt;= n; i++)&#123;
        if(!query[i].e)&#123;
            int pa = find(query[i].x), pb = find(query[i].y);
            if(pa == pb)&#123;
                cout &lt;&lt; &quot;NO&quot; &lt;&lt; endl;
                return;
            &#125;
        &#125;
    &#125;
    cout &lt;&lt; &quot;YES&quot; &lt;&lt; endl;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    int t;
    cin &gt;&gt; t;
    while(t--) solve();
&#125;
</code></pre><h3 id="é“¶æ²³è‹±é›„ä¼ è¯´"><a href="#é“¶æ²³è‹±é›„ä¼ è¯´" class="headerlink" title="é“¶æ²³è‹±é›„ä¼ è¯´"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQwLw==">é“¶æ²³è‹±é›„ä¼ è¯´</span></h3><ul><li>è®©æ’å¤´å½“æ ¹èŠ‚ç‚¹ï¼Œç»´æŠ¤å½“å‰æˆ˜èˆ°åˆ°æ’å¤´çš„è·ç¦»ï¼Œç›¸å¯¹è·ç¦» $|d[x] - d[y]| - 1$ ã€‚</li><li>$d[pa] &#x3D; size[pb]$, $size[pb] ; +&#x3D; ; size[pa]$</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 30010;
int p[N], sz[N], d[N];
int find(int x)&#123;
    if(p[x] != x)&#123;
        int root = find(p[x]);
        d[x] += d[p[x]];
        p[x] = root;
    &#125;
    return p[x];
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    for(int i = 1; i &lt; N; i++)&#123;
        p[i] = i;
        sz[i] = 1;
    &#125;
    int t;
    cin &gt;&gt; t;
    while(t--)&#123;
        char op;
        int x, y;
        cin &gt;&gt; op &gt;&gt; x &gt;&gt; y;
        if(op == &#39;M&#39;)&#123;
            int px = find(x), py = find(y);
            d[px] = sz[py];
            sz[py] += sz[px];
            p[px] = py;
        &#125;else&#123;
            int px = find(x), py = find(y);
            if(px == py)&#123;
                int ans = max(0, abs(d[x] - d[y]) - 1);
                cout &lt;&lt; ans &lt;&lt; endl;
            &#125;else&#123;
                cout &lt;&lt; &quot;-1&quot; &lt;&lt; endl;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre><h3 id="å¥‡å¶æ¸¸æˆ"><a href="#å¥‡å¶æ¸¸æˆ" class="headerlink" title="å¥‡å¶æ¸¸æˆ"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQxLw==">å¥‡å¶æ¸¸æˆ</span></h3><ul><li>ç”±æ•°æ®èŒƒå›´çŸ¥ï¼Œéœ€è¦ä½¿ç”¨ç¦»æ•£åŒ–ã€‚</li><li>é¢˜ç›®æ¡ä»¶å¯ä»¥è½¬æ¢æˆæ±‚å‰ç¼€å’Œï¼Œæ±‚ $S[L,R]$ ä¸­æ˜¯å¦æœ‰å¥‡æ•°ä¸ª 1ï¼Œå¯ä»¥è½¬æ¢æˆ $S_R - S_{L-1}$ ä¸ºå¥‡æ•°ï¼Œå¯ä»¥å†è½¬æ¢æˆåˆ¤æ–­ $S_R$ å’Œ $S_{L_1}$ å¥‡å¶æ€§ä¸åŒã€‚</li></ul><h4 id="æ‰©å±•åŸŸå¹¶æŸ¥é›†"><a href="#æ‰©å±•åŸŸå¹¶æŸ¥é›†" class="headerlink" title="æ‰©å±•åŸŸå¹¶æŸ¥é›†"></a>æ‰©å±•åŸŸå¹¶æŸ¥é›†</h4><ul><li>æ˜¯ä¸€ç§æšä¸¾çš„æ€è·¯ï¼Œ$x$ è¡¨ç¤ºå¦‚æœ $x$ æ˜¯å¶æ•°æƒ…å†µä¸‹ï¼Œ$x+n$ è¡¨ç¤ºå¦‚æœ $x$ æ˜¯å¥‡æ•°æƒ…å†µä¸‹ã€‚</li><li>é‡ç‚¹æ˜¯å¼„æ¸…æ¥šåŒä¸€ä¸ªé›†åˆé‡Œçš„å«ä¹‰ã€‚ä¸€èˆ¬æƒ…å†µæ˜¯æŸä¸ªé›†åˆä¸€ä¸ªæ¡ä»¶æˆç«‹ï¼Œåˆ™å…¶ä»–æ¡ä»¶å‡æˆç«‹ã€‚å³é›†åˆé‡Œä¿å­˜çš„æ˜¯æ¡ä»¶ã€‚</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 40010, Base = N / 2;
int cnt, p[N];
unordered_map&lt;int, int&gt; mp;
int getid(int x)&#123;
    if(!mp.count(x)) mp[x] = ++cnt;
    return mp[x];
&#125;
int find(int x)&#123;
    if(p[x] != x) p[x] = find(p[x]);
    return p[x];
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    int n, m;
    cin &gt;&gt; n &gt;&gt; m;
    for(int i = 1; i &lt; N; i++) p[i] = i;
    int pos = m;
    for(int i = 1; i &lt;= m; i++)&#123;
        int l, r;
        string op;
        cin &gt;&gt; l &gt;&gt; r &gt;&gt; op;
        l = getid(l - 1), r = getid(r);
        if(op == &quot;even&quot;)&#123;
            if(find(l + Base) == find(r))&#123;
                pos = i - 1;
                break;
            &#125;
            p[find(l)] = find(r);
            p[find(l + Base)] = find(r + Base);
        &#125;else&#123;
            if(find(l) == find(r))&#123;
                pos = i - 1;
                break;
            &#125;
            p[find(l + Base)] = find(r);
            p[find(l)] = find(r + Base);
        &#125;
    &#125;
    cout &lt;&lt; pos &lt;&lt; endl;
&#125;
</code></pre><h4 id="å¸¦è¾¹æƒçš„å¹¶æŸ¥é›†"><a href="#å¸¦è¾¹æƒçš„å¹¶æŸ¥é›†" class="headerlink" title="å¸¦è¾¹æƒçš„å¹¶æŸ¥é›†"></a>å¸¦è¾¹æƒçš„å¹¶æŸ¥é›†</h4><ul><li>$d[x]$ è¡¨ç¤º $x$ ä¸ $p[x]$ çš„å…³ç³»ã€‚<ul><li>$0$ è¡¨ç¤ºåŒç±»ï¼Œ$1$ è¡¨ç¤ºä¸åŒç±»</li></ul></li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 20010;
int cnt, p[N], d[N];
unordered_map&lt;int, int&gt; mp;
int getid(int x)&#123;
    if(!mp.count(x)) mp[x] = ++cnt;
    return mp[x];
&#125;
int find(int x)&#123;
    if(p[x] != x)&#123;
        int root = find(p[x]);
        d[x] ^= d[p[x]];
        p[x] = root;
    &#125;
    return p[x];
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    int n, m;
    cin &gt;&gt; n &gt;&gt; m;
    for(int i = 1; i &lt; N; i++) p[i] = i;
    int pos = m;
    for(int i = 1; i &lt;= m; i++)&#123;
        int l, r;
        string op;
        cin &gt;&gt; l &gt;&gt; r &gt;&gt; op;
        l = getid(l - 1), r = getid(r);
        int pa = find(l), pb = find(r);
        int t = 0;
        if(op == &quot;odd&quot;) t = 1;
        if(pa == pb)&#123;
            if((d[l] ^ d[r]) != t)&#123;
                pos = i - 1;
                break;
            &#125;
        &#125;else&#123;
            p[pa] = pb;
            d[pa] = d[l] ^ d[r] ^ t; // æ„é€ è·ç¦»
        &#125;
    &#125;
    cout &lt;&lt; pos &lt;&lt; endl;
&#125;
</code></pre><h2 id="æ ‘çŠ¶æ•°ç»„"><a href="#æ ‘çŠ¶æ•°ç»„" class="headerlink" title="æ ‘çŠ¶æ•°ç»„"></a>æ ‘çŠ¶æ•°ç»„</h2><ol><li>å¿«é€Ÿæ±‚å‰ç¼€å’Œ	$O(logn)$</li><li>ä¿®æ”¹æŸä¸€ä¸ªæ•°	$O(logn)$</li></ol><ul><li>åŸºäºäºŒè¿›åˆ¶æ€æƒ³	$X &#x3D; 2^{i_k} + 2^{i_{k-1}} + 2^{i_{k-2}} + \cdots + 2^{i_1}$ï¼Œå› æ­¤ $1 \sim x$ å¯ä»¥è¢«åˆ†æˆ $k$ æ®µã€‚</li><li>$(X - 2^{i_1}, X], (X - 2^{i_1} - 2^{i_2}, X - 2^{i_1}] \cdots (0, X - 2^{i_1} - 2^{i_2} \cdots - 2^{i_k}]$</li><li>$(L, R]$ é•¿åº¦ä¸€å®šæ˜¯ $R$ çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„æœ€åä¸€ä½ $1$ æ‰€å¯¹åº”çš„æ¬¡å¹‚ï¼Œå³ $[R - lowbit(R) + 1, R]$ã€‚</li><li>æ“ä½œ<ul><li>å¯¹ $a[x]$ è¿›è¡Œä¿®æ”¹ <code>for(int i = x; i &lt;= n; i += lowbit(i)) tr[i] += c;</code></li><li>æŸ¥è¯¢ $a[1 \sim x]$ çš„å’Œ <code>for(int i = x; i; i -= lowbit(i)) res += tr[i];</code></li></ul></li></ul><h3 id="æ¥¼å…°å›¾è…¾"><a href="#æ¥¼å…°å›¾è…¾" class="headerlink" title="æ¥¼å…°å›¾è…¾"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQzLw==">æ¥¼å…°å›¾è…¾</span></h3><ul><li>$tr[x]$ å­˜å‚¨çš„æ˜¯åŒºé—´ $[x - lowbit (x) + 1, x]$ å‡ºç°çš„æ•°çš„æ¬¡æ•°ï¼Œ$sum$ æ±‚çš„æ˜¯ $1 \sim x$ ä¸­å‡ºç°çš„æ•°çš„ä¸ªæ•°ã€‚</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 200010;
typedef long long LL;
int n;
int Greater[N], Lower[N];
int a[N], tr[N];
int lowbit(int x)&#123;
    return x &amp; (-x);
&#125;
void add(int x, int v)&#123;
    for(; x &lt;= n; x += lowbit(x)) tr[x] += v;
&#125;
int sum(int x)&#123;
    int res = 0;
    for(; x &gt; 0; x -= lowbit(x)) res += tr[x];
    return res;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n;
    for(int i = 1; i &lt;= n; i++) cin &gt;&gt; a[i];
    for(int i = 1; i &lt;= n; i++)&#123;
        int t = a[i];
        Greater[i] = sum(n) - sum(t);
        Lower[i] = sum(t - 1);
        add(t, 1);
    &#125;
    memset(tr, 0, sizeof(tr));
    LL ans1 = 0, ans2 = 0;
    for(int i = n; i; i--)&#123;
        int t = a[i];
        ans1 += Greater[i] * (LL)(sum(n) - sum(t));
        ans2 += Lower[i] * (LL)(sum(t - 1));
        add(t, 1);
    &#125;
    cout &lt;&lt; ans1 &lt;&lt; &#39; &#39; &lt;&lt; ans2 &lt;&lt; endl;
&#125;
</code></pre><h3 id="ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜-â… "><a href="#ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜-â… " class="headerlink" title="ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜ â… "></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQ4Lw==">ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜ â… </span></h3><ul><li>åŒºé—´ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢ï¼Œç›´æ¥ç”¨å·®åˆ†æ•°ç»„å»ºæ ‘ç»´æŠ¤å•ç‚¹å€¼ï¼ˆå‰ç¼€å’Œï¼‰ã€‚</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 200010;
int n;
int a[N], tr[N];
int lowbit(int x)&#123;
    return x &amp; (-x);
&#125;
void add(int x, int v)&#123;
    for(; x &lt;= n; x += lowbit(x)) tr[x] += v;
&#125;
LL sum(int x)&#123;
    LL res = 0;
    for(; x &gt; 0; x -= lowbit(x)) res += tr[x];
    return res;
&#125;
int main()&#123;
    int m;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n &gt;&gt; m;
    for(int i = 1; i &lt;= n; i++) cin &gt;&gt; a[i];
    for(int i = 1; i &lt;= n; i++) add(i, a[i] - a[i - 1]);
    while(m--)&#123;
        char op;
        int l, r, d;
        cin &gt;&gt; op;
        if(op == &#39;Q&#39;)&#123;
            cin &gt;&gt; d;
            cout &lt;&lt; sum(d) &lt;&lt; endl;
        &#125;else&#123;
            cin &gt;&gt; l &gt;&gt; r &gt;&gt; d;
            add(l, d); add(r + 1, -d);
        &#125;
    &#125;
&#125;
</code></pre><h3 id="ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜-â…¡-ğŸŒ¸"><a href="#ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜-â…¡-ğŸŒ¸" class="headerlink" title="ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜ â…¡ ğŸŒ¸"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQ0Lw==">ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜ â…¡</span> ğŸŒ¸</h3><ul><li>åŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æ±‚å’Œ</li><li>è¦åœ¨ $O(logn)$ çš„æ—¶é—´å¤æ‚åº¦å†…å¯¹å·®åˆ†æ ‘çŠ¶æ•°ç»„è¿›è¡ŒåŒºé—´æŸ¥è¯¢ï¼Œéœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ª $i \times b_i$ çš„å·®åˆ†æ ‘çŠ¶æ•°ç»„ã€‚</li><li>$S_n &#x3D; (b_1 + b_2 + \cdots + b_n) \times (n + 1) - (1 \times b_1 + 2 \times b_2 + \cdots i \times b_i)$</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 100010;
int n, m;
int a[N];
LL tr1[N], tr2[N];  // ç»´æŠ¤ b[i] å’Œ b[i] * i çš„å‰ç¼€å’Œ
int lowbit(int x)&#123;
    return x &amp; (-x);
&#125;
void add(LL tr[], int x, LL v)&#123;
    for(int i = x; i &lt;= n; i += lowbit(i)) tr[i] += v;
&#125;
LL sum(LL tr[], int x)&#123;
    LL res = 0;
    for(int i = x; i; i -= lowbit(i)) res += tr[i];
    return res;
&#125;
LL cal(int x)&#123;
    return sum(tr1, x) * (x + 1) - (sum(tr2, x));
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n &gt;&gt; m;
    for(int i = 1; i &lt;= n; i++) cin &gt;&gt; a[i];
    for(int i = 1; i &lt;= n; i++)&#123;
        int t = a[i] - a[i - 1];
        add(tr1, i, t); add(tr2, i, (LL)t * i);
    &#125;
    while(m--)&#123;
        char op;
        int l, r, d;
        cin &gt;&gt; op &gt;&gt; l &gt;&gt; r;
        if(op == &#39;Q&#39;) cout &lt;&lt; cal(r) - cal(l - 1) &lt;&lt; endl;
        else&#123;
            cin &gt;&gt; d;
            add(tr1, l, d); add(tr2, l, (LL)d * l);     // a[l] += d
            add(tr1, r + 1, -d); add(tr2, r + 1, -(LL)d * (r + 1));     // a[r] -= d
        &#125;
    &#125;
&#125;
</code></pre><h3 id="è°œä¸€æ ·çš„ç‰›-ğŸŒ¸"><a href="#è°œä¸€æ ·çš„ç‰›-ğŸŒ¸" class="headerlink" title="è°œä¸€æ ·çš„ç‰› ğŸŒ¸"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQ1Lw==">è°œä¸€æ ·çš„ç‰›</span> ğŸŒ¸</h3><ul><li>ä»å‰©ä½™çš„æ•°ä¸­ï¼Œæ‰¾åˆ°ç¬¬ $k$ å°çš„æ•°ã€‚$\Longleftrightarrow$ æ‰¾åˆ°ä¸€ä¸ªæœ€å°çš„ $x$ï¼Œä½¿å¾— $sum (x) &#x3D; k$ã€‚</li><li>åˆ é™¤æŸä¸ªæ•°ã€‚$\Longleftrightarrow$ $add(x, -1)$ã€‚</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 100010;
int n;
int h[N], tr[N], ans[N];
int lowbit(int x)&#123;
    return x &amp; (-x);
&#125;
void add(int x, int v)&#123;
    for(int i = x; i &lt;= n; i += lowbit(i)) tr[i] += v;
&#125;
int sum(int x)&#123;
    int res = 0;
    for(int i = x; i; i -= lowbit(i)) res += tr[i];
    return res;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n;
    for(int i = 1; i &lt;= n; i++) tr[i] = lowbit(i);
    for(int i = 2; i &lt;= n; i++) cin &gt;&gt; h[i];
    for(int i = n; i; i--)&#123;
        int k = h[i] + 1;
        int l = 1, r = n;
        while(l &lt; r)&#123;
            int mid = (l + r) &gt;&gt; 1;
            if(sum(mid) &gt;= k) r = mid;
            else l = mid + 1;
        &#125;
        ans[i] = l;
        add(l, -1);
    &#125;
    for(int i = 1; i &lt;= n; i++) cout &lt;&lt; ans[i] &lt;&lt; endl;
&#125;
</code></pre><h3 id="CF383C-Propagating-tree"><a href="#CF383C-Propagating-tree" class="headerlink" title="CF383C | Propagating tree"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cubHVvZ3UuY29tLmNuL3Byb2JsZW0vQ0YzODND">CF383C | Propagating tree</span></h3><ul><li>é¢˜æ„<ul><li>æ ‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼ï¼Œæœ‰ä¸¤ç§æ“ä½œï¼š<ul><li>ç»™ä¸€ä¸ªèŠ‚ç‚¹çš„æƒå€¼å¢åŠ  $val$ï¼Œ å®ƒçš„å­èŠ‚ç‚¹æƒå€¼éƒ½å¢åŠ  $-val$ï¼Œ å®ƒå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æƒå€¼éƒ½å¢åŠ  $-(-val)$ï¼Œä¸€ç›´åˆ°æ ‘çš„åº•éƒ¨ã€‚</li><li>æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹çš„æƒå€¼ã€‚</li></ul></li></ul></li><li>é¢˜è§£<ul><li>å¯ä»¥æ ‘å‰–ç»“åˆçº¿æ®µæ ‘ç»´æŠ¤ï¼Œæˆ‘ä»¬è€ƒè™‘è®©æ·±åº¦ä¸ºå¥‡æ•°çš„æ ¹çš„å­æ ‘ä¿®æ”¹çš„æ—¶å€™ç›´æ¥åŠ  $val$ï¼Œå¶æ•°çš„ç›´æ¥å‡å» $val$ã€‚è¿™æ ·æˆ‘ä»¬å°±æ¶ˆé™¤äº†æ‰€åŠ çš„å­æ ‘æ ¹ç»“ç‚¹æ·±åº¦ä¸åŒçš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ‡’æ ‡è®°å°±å¯ä»¥åˆå¹¶äº†ã€‚</li><li>å› ä¸ºå…ˆå‰æˆ‘ä»¬å¯¹æ·±åº¦ä¸åŒçš„ç»“ç‚¹åšå‡ºçš„è°ƒæ•´ï¼Œæ‰€ä»¥æœ€åæˆ‘ä»¬åªéœ€è¦åœ¨è®¿é—®åˆ°æ¯ä¸ªç‚¹çš„æ—¶å€™åˆ¤æ–­ä¸€ä¸‹æ·±åº¦çš„å¥‡å¶æ€§ï¼Œå¯¹åº”çš„åŠ å‡å°±è¡Œäº†ã€‚</li><li>ä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤ä¸€ä¸ªå·®åˆ†æ•°ç»„ $f[n]$ï¼Œè¡¨ç¤ºç¬¬ $n$ å·èŠ‚ç‚¹çš„ä¿®æ”¹æƒ…å†µï¼Œå…¶ä¸­å¦‚æœ $depth[n]$ æ˜¯å¥‡æ•°åˆ™è®°å½•å¢åŠ é‡ï¼Œå¦åˆ™è®°å½•å‡å°‘é‡ã€‚åˆ™é¢˜ä¸­ä¿®æ”¹å°±ç­‰åŒäºåœ¨ $dfs$ åºä¸Šä¿®æ”¹ä¸€æ®µåŒºé—´ï¼ˆå› ä¸ºè¿™æ—¶å€™å¢å‡å·²ç»ä¸å½±å“äº†ï¼‰ã€‚</li></ul></li><li>ä»£ç </li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 2e5 + 10;
int tr[N], l[N], r[N];
int n, m;
inline int lowbit(int x)&#123;
    return x &amp; -x;
&#125;
inline void add(int x, int v)&#123;
    for(; x &lt;= n; x += lowbit(x))
        tr[x] += v;
&#125;
inline int sum(int x)&#123;
    int ret = 0;
    for(; x &gt; 0; x -= lowbit(x))
        ret += tr[x];
    return ret;
&#125;

int h[N], e[N &lt;&lt; 1], ne[N &lt;&lt; 1], idx;
inline void addedge(int a, int b)&#123;
    e[idx] = b, ne[idx] = h[a], h[a] = idx++;
&#125;
int depth[N], tot;
void dfs(int u, int fa)&#123;
    l[u] = ++tot;
    for(int i = h[u]; ~i; i = ne[i])&#123;
        int j = e[i];
        if(j == fa) continue;
        depth[j] = depth[u] + 1;
        dfs(j, u);
    &#125;
    r[u] = tot;
&#125;
int val[N];
int main()&#123;
    cin.tie(0)-&gt;sync_with_stdio(0);
    cin &gt;&gt; n &gt;&gt; m;
    memset(h, -1, sizeof h);
    for(int i = 1; i &lt;= n; i++)&#123;
        cin &gt;&gt; val[i];
    &#125;
    for(int i = 1; i &lt; n; i++)&#123;
        int a, b;
        cin &gt;&gt; a &gt;&gt; b;
        addedge(a, b);
        addedge(b, a);
    &#125;
    dfs(1, 0);
    for(int i = 1; i &lt;= m; i++)&#123;
        int a, b;
        cin &gt;&gt; a &gt;&gt; b;
        if(a == 1)&#123;
            int x;
            cin &gt;&gt; x;
            if(depth[b] &amp; 1) add(l[b], x), add(r[b] + 1, -x);
            else add(l[b], -x), add(r[b] + 1, x);
        &#125;else&#123;
            int x = sum(l[b]);
            if(depth[b] &amp; 1) cout &lt;&lt; val[b] + x &lt;&lt; &#39;\n&#39;;
            else cout &lt;&lt; val[b] - x &lt;&lt; &#39;\n&#39;;
        &#125;
    &#125;
&#125;
</code></pre><h2 id="çº¿æ®µæ ‘"><a href="#çº¿æ®µæ ‘" class="headerlink" title="çº¿æ®µæ ‘"></a>çº¿æ®µæ ‘</h2><ul><li>$pushup$<ul><li>ç”±å­èŠ‚ç‚¹æ›´æ–°çˆ¶èŠ‚ç‚¹ã€‚</li><li>å•ç‚¹ä¿®æ”¹</li></ul></li><li>$pushdown$ ï¼ˆæ‡’æ ‡è®°ã€å»¶è¿Ÿæ ‡è®°ï¼‰<ul><li>ç”±çˆ¶èŠ‚ç‚¹æ›´æ–°å­èŠ‚ç‚¹ã€‚</li><li>åŒºé—´ä¿®æ”¹</li><li>ä¾‹å¦‚ï¼š $add$ æ‡’æ ‡è®°ï¼Œç»™ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹åŠ ä¸Š $add$ è¿™ä¸ªæ•°ï¼ˆä¸åŒ…å«æ ¹èŠ‚ç‚¹ï¼‰<ul><li><code>left.add += root.add, left.sum += (left.r - left.l + 1) * root.add</code></li><li><code>right.add += root.add, right.sum += (right.r - right.l + 1) * root.add</code></li><li><code>root.add = 0</code></li></ul></li></ul></li><li>é™¤æœ€åä¸€å±‚æ˜¯æ»¡äºŒå‰æ ‘ï¼Œå­åŒºé—´åˆ’åˆ† $mid &#x3D; \left \lfloor \frac{l + r}{2} \right \rfloor$ å³ $[L, mid],[mid + 1, R]$ï¼Œå¯ä»¥ç”¨ä¸€ç»´æ•°ç»„å­˜æ•´æ£µæ ‘ï¼Œæœ€å¤šç”± $2n - 1 + 2n$ ä¸ªç‚¹ï¼Œæ•…éœ€è¦å¼€ 4 å€çš„ç©ºé—´ã€‚</li><li>æ‰«æçº¿æ³•</li><li>æ“ä½œ<ul><li><code>pushup()</code></li><li><code>pushdown()</code></li><li><code>build()</code> å°†ä¸€æ®µåŒºé—´åˆå§‹åŒ–ä¸ºçº¿æ®µæ ‘ã€‚</li><li><code>modify()</code> ä¿®æ”¹å•ç‚¹ã€ä¿®æ”¹åŒºé—´ï¼ˆå»¶è¿Ÿæ›´æ–°ï¼‰ã€‚</li><li><code>query()</code></li></ul></li></ul><pre><code class="cpp">build(int u, int l, int r)&#123;
    tr[u].l = l, tr[u].r = r;
    if(l == r) return;
    int mid = l + r &gt;&gt; 1;
    build(u &lt;&lt; 1, l, mid), build(u &lt;&lt; 1 | 1, mid + 1, r);
    pushup(u); // ä¸€èˆ¬äºæ­¤å†™ pushup æ“ä½œ
&#125;
</code></pre><h3 id="åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘"><a href="#åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘" class="headerlink" title="åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘"></a>åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘</h3><ul><li>é€šå¸¸æ¥è¯´ï¼Œçº¿æ®µæ ‘å ç”¨ç©ºé—´æ˜¯æ€»åŒºé—´é•¿ $n$ çš„å¸¸æ•°å€ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯ $O(n)$ã€‚ç„¶è€Œï¼Œæœ‰æ—¶å€™ $n$ å¾ˆå·¨å¤§ï¼Œè€Œæˆ‘ä»¬åˆä¸éœ€è¦ä½¿ç”¨æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œè¿™æ—¶ä¾¿å¯ä»¥åŠ¨æ€å¼€ç‚¹â€”â€”ä¸å†ä¸€æ¬¡æ€§å»ºå¥½æ ‘ï¼Œè€Œæ˜¯ä¸€è¾¹ä¿®æ”¹ã€æŸ¥è¯¢ä¸€è¾¹å»ºç«‹ã€‚è®¾æ€»æŸ¥è¯¢æ¬¡æ•°ä¸º $m$ï¼Œåˆ™è¿™æ ·çš„æ€»ç©ºé—´å¤æ‚åº¦ä¸º $O(m;log;n)$ã€‚</li><li>æ¯”èµ·æ™®é€šçº¿æ®µæ ‘ï¼ŒåŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘æœ‰ä¸€ä¸ªä¼˜åŠ¿ï¼Œå®ƒèƒ½å¤Ÿå¤„ç†é›¶æˆ–è´Ÿæ•°ä½ç½®ã€‚æ­¤æ—¶ï¼Œæ±‚ $mid$ æ—¶ä¸èƒ½ç”¨ $(cl + cr) &#x2F; 2$ï¼Œè€Œè¦ç”¨ $(cl + cr - 1) &#x2F; 2$ã€‚</li><li>é€šå¸¸ç”¨åœ¨æ²¡æœ‰æä¾›åˆå§‹æ•°æ®çš„åœºåˆï¼ˆä¾‹å¦‚åˆå§‹å…¨0ï¼‰ï¼Œè¿™æ—¶æ›´èƒ½æ˜¾ç¤ºå‡ºä¼˜åŠ¿ã€‚</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
#define ls(x) tr[x].ls
#define rs(x) tr[x].rs
#define val(x) tr[x].val
#define mark(x) tr[x].mark
// N ä¸€èˆ¬èƒ½å¼€å¤šå¤§å¼€å¤šå¤§ï¼Œä¾‹å¦‚å†…å­˜é™åˆ¶ 128M æ—¶å¯ä»¥å¼€åˆ°å…«ç™¾ä¸‡å·¦å³
const int N = 8e6;
int L = 1, R = 1e5, cnt = 1;
struct Node&#123;
    int ls, rs;
    LL val, mark;
&#125;tr[N];
void push_down(int p, int len)&#123;
    if(len &lt;= 1) return;
    if(!ls(p)) ls(p) = ++cnt;
    if(!rs(p)) rs(p) = ++cnt;
    val(ls(p)) += mark(p) * (len / 2);
    mark(ls(p)) += mark(p);
    val(rs(p)) += mark(p) * (len - len / 2);
    mark(rs(p)) += mark(p);
    mark(p) = 0;
&#125;
LL query(int u, int l, int r, int cl = L, int cr = R)&#123;
    if(cl &gt;= l &amp;&amp; cr &lt;= r) return val(u);
    push_down(u, cr - cl + 1);
    LL mid = (cl + cr - 1) / 2, ans = 0;
    if(l &lt;= mid) ans += query(ls(u), l, r, cl, mid);
    if(r &gt; mid) ans += query(rs(u), l, r, mid + 1, cr);
    return ans;
&#125;
void update(int l, int r, int d, int u = 1, int cl = L, int cr = R)&#123;
    if(cl &gt;= l &amp;&amp; cr &lt;= r)&#123;
        val(u) += d * (cr - cl + 1);
        mark(u) += d;
        return;
    &#125;
    push_down(u, cr - cl + 1);
    LL mid = (cl + cr - 1) / 2;
    if(l &lt;= mid) update(l, r, d, ls(u), cl, mid);
    if(r &gt; mid) update(l, r, d, rs(u), mid + 1, cr);
    val(u) = val(ls(u)) + val(rs(u));
&#125;
</code></pre><h3 id="æœ€å¤§æ•°-ğŸŒ¸"><a href="#æœ€å¤§æ•°-ğŸŒ¸" class="headerlink" title="æœ€å¤§æ•° ğŸŒ¸"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMTI3Ny8=">æœ€å¤§æ•°</span> ğŸŒ¸</h3><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 200010;
int m, p;
struct Node
&#123;
    int l, r;
    int v;      // åŒºé—´[l, r]ä¸­çš„æœ€å¤§å€¼
&#125;tr[N * 4];

void pushup(int u)&#123;     // ç”±å­èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæ›´æ–°çˆ¶èŠ‚ç‚¹çš„ä¿¡æ¯
    tr[u].v = max(tr[u &lt;&lt; 1].v, tr[u &lt;&lt; 1 | 1].v);
&#125;
void build(int u, int l, int r)&#123;
    tr[u] = &#123;l, r&#125;;
    if(l == r) return;
    int mid = (l + r) &gt;&gt; 1;
    build(u &lt;&lt; 1, l, mid), build(u &lt;&lt; 1 | 1, mid + 1, r);
&#125;
int query(int u, int l, int r)&#123;
    if(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r) return tr[u].v;    // åŒºé—´[l, r]åœ¨å½“å‰èŠ‚ç‚¹çš„åŒºé—´å†…
    int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
    int v = 0;
    if(l &lt;= mid) v = query(u &lt;&lt; 1, l, r);
    if(r &gt; mid) v = max(v, query(u &lt;&lt; 1 | 1, l, r));
    return v;
&#125;
void modify(int u, int x, int v)&#123;
    if(tr[u].l == x &amp;&amp; tr[u].r == x) tr[u].v = v;
    else&#123;
        int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
        if(x &lt;= mid) modify(u &lt;&lt; 1, x, v);
        else modify(u &lt;&lt; 1 | 1, x, v);
        pushup(u);
    &#125;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    int n = 0, last = 0;
    cin &gt;&gt; m &gt;&gt; p;
    build(1, 1, m);
    int x;
    while(m--)&#123;
        char op;
        cin &gt;&gt; op &gt;&gt; x;
        if(op == &#39;Q&#39;)&#123;
            last = query(1, n - x + 1, n);
            cout &lt;&lt; last &lt;&lt; endl;
        &#125;else&#123;
            modify(1, n + 1, ((long long)last + x) % p);
            n++;
        &#125;
    &#125;
&#125;
</code></pre><h3 id="ä½ èƒ½å›ç­”è¿™äº›é—®é¢˜å—-ğŸŒ¸"><a href="#ä½ èƒ½å›ç­”è¿™äº›é—®é¢˜å—-ğŸŒ¸" class="headerlink" title="ä½ èƒ½å›ç­”è¿™äº›é—®é¢˜å— ğŸŒ¸"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQ2Lw==">ä½ èƒ½å›ç­”è¿™äº›é—®é¢˜å—</span> ğŸŒ¸</h3><ul><li>ç»´æŠ¤æ¯ä¸ªåŒºé—´åç¼€æœ€å¤§å’Œï¼Œå‰ç¼€æœ€å¤§å’Œï¼ŒåŒºé—´å’Œï¼ŒåŒºé—´æœ€å¤§å­æ®µå’Œã€‚</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 500010;
int n, m;
int w[N];
struct Node
&#123;
    int l, r;
    int sum, lmax, rmax, tmax;
&#125;tr[N * 4];
void pushup(Node &amp;u, Node &amp;l, Node &amp;r)&#123;
    u.sum = l.sum + r.sum;
    u.lmax = max(l.lmax, l.sum + r.lmax);
    u.rmax = max(r.rmax, r.sum + l.rmax);
    u.tmax = max(max(l.tmax, r.tmax), l.rmax + r.lmax);
&#125;
void pushup(int u)&#123;
    pushup(tr[u], tr[u &lt;&lt; 1], tr[u &lt;&lt; 1 | 1]);
&#125;
void build(int u, int l, int r)&#123;
    if(l == r) tr[u] = &#123;l, r, w[r], w[r], w[r], w[r]&#125;;
    else&#123;
        tr[u] = &#123;l, r&#125;;
        int mid = (l + r) &gt;&gt; 1;
        build(u &lt;&lt; 1, l, mid), build(u &lt;&lt; 1 | 1, mid + 1, r);
        pushup(u);
    &#125;
&#125;
void modify(int u, int x, int v)&#123;
    if(tr[u].l == x &amp;&amp; tr[u].r == x) tr[u] = &#123;x, x, v, v, v, v&#125;;
    else&#123;
        int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
        if(x &lt;= mid) modify(u &lt;&lt; 1, x, v);
        else modify(u &lt;&lt; 1 | 1, x, v);
        pushup(u);
    &#125;
&#125;
Node query(int u, int l, int r)&#123;
    if(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r) return tr[u];
    else&#123;
        int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
        if(r &lt;= mid) return query(u &lt;&lt; 1, l, r);
        else if(l &gt; mid) return query(u &lt;&lt; 1 | 1, l, r);
        else&#123;
            auto left = query(u &lt;&lt; 1, l, r);
            auto right = query(u &lt;&lt; 1 | 1, l, r);
            Node res;
            pushup(res, left, right);
            return res;
        &#125;
    &#125;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n &gt;&gt; m;
    for(int i = 1; i &lt;= n; i++) cin &gt;&gt; w[i];
    build(1, 1, n);
    int x, y;
    while(m--)&#123;
        int op;
        cin &gt;&gt; op &gt;&gt; x &gt;&gt; y;
        if(op == 1)&#123;
            if(x &gt; y) swap(x, y);
            cout &lt;&lt; query(1, x, y).tmax &lt;&lt; endl;
        &#125;else&#123;
            modify(1, x, y);
        &#125;
    &#125;
&#125;
</code></pre><h3 id="åŒºé—´æœ€å¤§å…¬çº¦æ•°-ğŸŒ¸"><a href="#åŒºé—´æœ€å¤§å…¬çº¦æ•°-ğŸŒ¸" class="headerlink" title="åŒºé—´æœ€å¤§å…¬çº¦æ•° ğŸŒ¸"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQ3Lw==">åŒºé—´æœ€å¤§å…¬çº¦æ•°</span> ğŸŒ¸</h3><ul><li>æœ€å¤§å…¬çº¦æ•°<ul><li>ä¸€å®šå­˜åœ¨ $(x, y, z) ; &#x3D; ; (x, y - x, z - y)$</li><li>ç”¨çº¿æ®µæ ‘ç»´æŠ¤æ‰€æœ‰å·®åˆ†çš„å€¼ã€‚å•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢ã€‚</li><li>$gcd(a[l], gcd(b[l + 1], b[l + 2], \cdots b[r]))$</li></ul></li><li>åŒºé—´ $[l, r]$ å¢åŠ ä¸€ä¸ªæ•°<ul><li>å·®åˆ†æ€æƒ³ï¼Œå°†åŒºé—´åŠ å‡å˜æˆå•ç‚¹åŠ å‡ã€‚</li></ul></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9zb2x1dGlvbi9jb250ZW50LzEwNDcv">è¯¦ç»†é¢˜è§£</span></li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 500010;
int n, m;
LL w[N];
struct Node&#123;
    int l, r;
    LL sum, d;
&#125;tr[N * 4];
LL gcd(LL a, LL b)&#123;
    return b == 0 ? a : gcd(b, a % b);
&#125;
void pushup(Node &amp;u, Node &amp;l, Node &amp;r)&#123;
    u.sum = l.sum + r.sum;
    u.d = gcd(l.d, r.d);
&#125;
void pushup(int u)&#123;
    pushup(tr[u], tr[u &lt;&lt; 1], tr[u &lt;&lt; 1 | 1]);
&#125;
void build(int u, int l, int r)&#123;
    if(l == r)&#123;
        LL b = w[r] - w[r - 1];
        tr[u] = &#123;l, r, b, b&#125;;
    &#125;else&#123;
        tr[u] = &#123;l, r&#125;;
        int mid = (l + r) &gt;&gt; 1;
        build(u &lt;&lt; 1, l, mid), build(u &lt;&lt; 1 | 1, mid + 1, r);
        pushup(u);
    &#125;
&#125;
void modify(int u, int x, LL v)&#123;
    if(tr[u].l == x &amp;&amp; tr[u].r == x)&#123;
        LL b = tr[u].sum + v;
        tr[u] = &#123;x, x, b, b&#125;;
    &#125;else&#123;
        int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
        if(x &lt;= mid) modify(u &lt;&lt; 1, x, v);
        else modify(u &lt;&lt; 1 | 1, x, v);
        pushup(u);
    &#125;
&#125;
Node query(int u, int l, int r)&#123;
    if(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r) return tr[u];
    else&#123;
        int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
        if(r &lt;= mid) return query(u &lt;&lt; 1, l, r);
        else if(l &gt; mid) return query(u &lt;&lt; 1 | 1, l, r);
        else&#123;
            auto left = query(u &lt;&lt; 1, l, r);
            auto right = query(u &lt;&lt; 1 | 1, l, r);
            Node res;
            pushup(res, left, right);
            return res;
        &#125;
    &#125;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n &gt;&gt; m;
    for(int i = 1; i &lt;= n; i++) cin &gt;&gt; w[i];
    build(1, 1, n);
    
    int l, r;
    LL d;
    char op;
    while(m--)&#123;
        cin &gt;&gt; op &gt;&gt; l &gt;&gt; r;
        if(op == &#39;Q&#39;)&#123;
            auto left  = query(1, 1, l);
            Node right(&#123;0, 0, 0, 0&#125;);
            if(l + 1 &lt;= r) right = query(1, l + 1, r);
            cout &lt;&lt; abs(gcd(left.sum, right.d)) &lt;&lt; endl;    // éœ€è¦æ­£æ•°
        &#125;else&#123;
            cin &gt;&gt; d;
            modify(1, l, d);
            if(r + 1 &lt;= n) modify(1, r + 1, -d);
        &#125;
    &#125;
&#125;
</code></pre><h3 id="ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜-â…¡-ğŸŒ¸-1"><a href="#ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜-â…¡-ğŸŒ¸-1" class="headerlink" title="ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜ â…¡ ğŸŒ¸"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQ0Lw==">ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜ â…¡</span> ğŸŒ¸</h3><ul><li>ä¿¡æ¯<ul><li>$sum$ å¦‚æœè€ƒè™‘å½“å‰èŠ‚ç‚¹åŠå­èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æ ‡è®°ï¼Œå½“å‰åŒºé—´å’Œæ˜¯å¤šå°‘ã€‚</li><li>$add$ æ‡’æ ‡è®°ï¼Œç»™ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹åŠ ä¸Š $add$ è¿™ä¸ªæ•°ï¼ˆä¸åŒ…å«æ ¹èŠ‚ç‚¹ï¼‰<ul><li><code>left.add += root.add, left.sum += (left.r - left.l + 1) * root.add</code></li><li><code>right.add += root.add, right.sum += (right.r - right.l + 1) * root.add</code></li><li><code>root.add = 0</code></li></ul></li></ul></li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 100010;
int n, m;
int w[N];
struct Node&#123;
    int l, r;
    LL sum, add;
&#125;tr[N * 4];
void pushup(int u)&#123;
    tr[u].sum = tr[u &lt;&lt; 1].sum + tr[u &lt;&lt; 1 | 1].sum;
&#125;
void pushdown(int u)&#123;
    auto &amp;root = tr[u], &amp;left = tr[u &lt;&lt; 1], &amp;right = tr[u &lt;&lt; 1 | 1];
    if(root.add)&#123;
        left.add += root.add, left.sum += (LL)(left.r - left.l + 1) * root.add;
        right.add += root.add, right.sum += (LL)(right.r - right.l + 1) * root.add;
        root.add = 0;
    &#125;
&#125;
void build(int u, int l, int r)&#123;
    if(l == r) tr[u] = &#123;l, r, w[l], 0&#125;;
    else&#123;
        tr[u] = &#123;l, r&#125;;
        int mid = (l + r) &gt;&gt; 1;
        build(u &lt;&lt; 1, l, mid); build(u &lt;&lt; 1 | 1, mid + 1, r);
        pushup(u);
    &#125;
&#125;
void modify(int u, int l, int r, int d)&#123;
    if(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r)&#123;
        tr[u].sum += (LL)(tr[u].r - tr[u].l + 1) * d;
        tr[u].add += d;
    &#125;else&#123;      // åˆ†è£‚
        pushdown(u);
        int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
        if(l &lt;= mid) modify(u &lt;&lt; 1, l, r, d);
        if(r &gt; mid) modify(u &lt;&lt; 1 | 1, l, r, d);
        pushup(u);
    &#125;
&#125;
LL query(int u, int l, int r)&#123;
    if(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r) return tr[u].sum;
    pushdown(u);
    int mid = tr[u].l + tr[u].r &gt;&gt; 1;
    LL sum = 0;
    if(l &lt;= mid) sum = query(u &lt;&lt; 1, l, r);
    if(r &gt; mid) sum += query(u &lt;&lt; 1 | 1, l, r);
    return sum;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n &gt;&gt; m;
    for(int i = 1; i &lt;= n; i++) cin &gt;&gt; w[i];
    build(1, 1, n);
    char op;
    int l, r, d;
    while(m--)&#123;
        cin &gt;&gt; op &gt;&gt; l &gt;&gt; r;
        if(op == &#39;C&#39;)&#123;
            cin &gt;&gt; d;
            modify(1, l, r, d);
        &#125;else&#123;
            cout &lt;&lt; query(1, l, r) &lt;&lt; endl;
        &#125;
    &#125;
&#125;
</code></pre><h3 id="äºšç‰¹å…°è’‚æ–¯-ğŸŒ¸ğŸŒ¸"><a href="#äºšç‰¹å…°è’‚æ–¯-ğŸŒ¸ğŸŒ¸" class="headerlink" title="äºšç‰¹å…°è’‚æ–¯ ğŸŒ¸ğŸŒ¸"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjQ5Lw==">äºšç‰¹å…°è’‚æ–¯</span> ğŸŒ¸ğŸŒ¸</h3><ul><li>åœ¨ $y$ è½´å»ºç«‹çº¿æ®µæ ‘ï¼Œæ¯ä¸€ä¸ªçŸ©å½¢çš„å·¦è¾¹æƒå€¼ä¸º $1$ï¼Œå³è¾¹æƒå€¼ä¸º $-1$</li><li>çº¿æ®µæ ‘ä¸­çš„èŠ‚ç‚¹ä¿¡æ¯<ul><li>$cnt$ å½“å‰åŒºé—´æ•´ä¸ªè¢«è¦†ç›–æ¬¡æ•°</li><li>$len$ ä¸è€ƒè™‘ç¥–å…ˆèŠ‚ç‚¹ $cnt$ çš„å‰æä¸‹ï¼Œ$cnt &gt; 0$ çš„åŒºé—´æ€»é•¿ã€‚</li></ul></li><li>æœ¬é¢˜è€ƒè™‘æ‰«æçº¿çš„ç‰¹æ®Šæ€§è´¨<ul><li>æ°¸è¿œåªè€ƒè™‘æ ¹èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå³ <code>query</code> æ—¶ä¸ä¼šè°ƒç”¨ <code>pushdown</code></li><li>æ‰€æœ‰æ“ä½œéƒ½æ˜¯æˆå¯¹å‡ºç°ï¼Œä¸”å…ˆåŠ åå‡</li></ul></li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 100010;
struct Segment&#123;
    double x, y1, y2;
    int k;
    bool operator &lt; (const Segment &amp;t) const&#123;
        return x &lt; t.x;
    &#125;
&#125;seg[N * 2];
struct Node&#123;
    int l, r;
    int cnt;
    double len;
&#125;tr[N * 8];
vector&lt;double&gt; origin;

int find(double y)&#123;
    return lower_bound(origin.begin(), origin.end(), y) - origin.begin();
&#125;
void pushup(int u)&#123;
    if(tr[u].cnt) tr[u].len = origin[tr[u].r + 1] - origin[tr[u].l];
    else if(tr[u].l != tr[u].r) tr[u].len = tr[u &lt;&lt; 1].len + tr[u &lt;&lt; 1 | 1].len;
    else tr[u].len = 0;
&#125;
void build(int u, int l, int r)&#123;
    tr[u] = &#123;l, r, 0, 0&#125;;
    if(l != r)&#123;
        int mid = (l + r) &gt;&gt; 1;
        build(u &lt;&lt; 1, l, mid); build(u &lt;&lt; 1 | 1, mid + 1, r);
    &#125;
&#125;
void modify(int u, int l, int r, int k)&#123;
    if(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r)&#123;
        tr[u].cnt += k;
        pushup(u);
    &#125;else&#123;
        int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
        if(l &lt;= mid) modify(u &lt;&lt; 1, l, r, k);
        if(r &gt; mid) modify(u &lt;&lt; 1 | 1, l, r, k);
        pushup(u);
    &#125;
&#125;
void solve(int n)&#123;
    origin.clear();
    for(int i = 0, j = 0; i &lt; n; i++)&#123;
        double x1, y1, x2, y2;
        cin &gt;&gt; x1 &gt;&gt; y1 &gt;&gt; x2 &gt;&gt; y2;
        seg[j++] = &#123;x1, y1, y2, 1&#125;;
        seg[j++] = &#123;x2, y1, y2, -1&#125;;
        origin.push_back(y1), origin.push_back(y2);
    &#125;
    sort(origin.begin(), origin.end());
    origin.erase(unique(origin.begin(), origin.end()), origin.end());
    build(1, 0, origin.size() - 2);
    sort(seg, seg + n * 2);
    double ans = 0;
    for(int i = 0; i &lt; n * 2; i++)&#123;
        if (i &gt; 0) ans += tr[1]. len * (seg[i]. x - seg[i - 1]. x);
        modify(1, find(seg[i].y1), find(seg[i].y2) - 1, seg[i].k);
    &#125;
    cout &lt;&lt; &quot;Total explored area: &quot; &lt;&lt; fixed &lt;&lt; setprecision(2) &lt;&lt; ans &lt;&lt; endl;
    cout &lt;&lt; endl;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    int t = 1, n;
    while(cin &gt;&gt; n &amp;&amp; n)&#123;
        cout &lt;&lt; &quot;Test case #&quot; &lt;&lt; t++ &lt;&lt; endl;
        solve(n);
    &#125;
&#125;
</code></pre><h3 id="ç»´æŠ¤åºåˆ—-ğŸŒ¸"><a href="#ç»´æŠ¤åºåˆ—-ğŸŒ¸" class="headerlink" title="ç»´æŠ¤åºåˆ— ğŸŒ¸"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMTI3OS8=">ç»´æŠ¤åºåˆ—</span> ğŸŒ¸</h3><ul><li>å…ˆä¹˜ååŠ </li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 100010;
int n, p, m;
int w[N];
struct Node&#123;
    int l, r;
    int sum, add, mul;
&#125;tr[N * 4];

void pushup(int u)&#123;
    tr[u].sum = (tr[u &lt;&lt; 1].sum + tr[u &lt;&lt; 1 | 1].sum) % p;
&#125;
void eval(Node &amp;t, int add, int mul)&#123;
    t.sum = ((LL)t.sum * mul + (LL)(t.r - t.l + 1) * add) % p;
    t.mul = ((LL)t.mul * mul) % p;
    t.add = ((LL)t.add * mul + add) % p;
&#125;
void pushdown(int u)&#123;
    eval(tr[u &lt;&lt; 1], tr[u].add, tr[u].mul);
    eval(tr[u &lt;&lt; 1 | 1], tr[u].add, tr[u].mul);
    tr[u].add = 0, tr[u].mul = 1;
&#125;
void build(int u, int l, int r)&#123;
    if(l == r) tr[u] = &#123;l, r, w[r], 0, 1&#125;;
    else&#123;
        tr[u] = &#123;l, r, 0, 0, 1&#125;;
        int mid = (l + r) &gt;&gt; 1;
        build(u &lt;&lt; 1, l, mid); build(u &lt;&lt; 1 | 1, mid + 1, r);
        pushup(u);
    &#125;
&#125;
void modify(int u, int l, int r, int add, int mul)&#123;
    if(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r) eval(tr[u], add, mul);
    else&#123;
        pushdown(u);
        int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
        if(l &lt;= mid) modify(u &lt;&lt; 1, l, r, add, mul);
        if(r &gt; mid) modify(u &lt;&lt; 1 | 1, l, r, add, mul);
        pushup(u);
    &#125;
&#125;
int query(int u, int l, int r)&#123;
    if(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r) return tr[u].sum;
    pushdown(u);
    int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
    int sum = 0;
    if(l &lt;= mid) sum = query(u &lt;&lt; 1, l, r);
    if(r &gt; mid) sum = (sum + query(u &lt;&lt; 1 | 1, l, r)) % p;
    return sum;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n &gt;&gt; p;
    for(int i = 1; i &lt;= n; i++) cin &gt;&gt; w[i];
    build(1, 1, n);

    cin &gt;&gt; m;
    while(m--)&#123;
        int t, l, r, d;
        cin &gt;&gt; t &gt;&gt; l &gt;&gt; r;
        if(t == 1)&#123;
            cin &gt;&gt; d;
            modify(1, l, r, 0, d);
        &#125;else if(t == 2)&#123;
            cin &gt;&gt; d;
            modify(1, l, r, d, 1);
        &#125;else&#123;
            cout &lt;&lt; query(1, l, r) &lt;&lt; endl;
        &#125;
    &#125;
&#125;
</code></pre><h2 id="å¯æŒä¹…åŒ–æ•°æ®ç»“æ„"><a href="#å¯æŒä¹…åŒ–æ•°æ®ç»“æ„" class="headerlink" title="å¯æŒä¹…åŒ–æ•°æ®ç»“æ„"></a>å¯æŒä¹…åŒ–æ•°æ®ç»“æ„</h2><ul><li>$trie$ çš„å¯æŒä¹…åŒ–</li><li>çº¿æ®µæ ‘çš„å¯æŒä¹…åŒ–â€“ä¸»å¸­æ ‘</li><li>å¯æŒä¹…åŒ–çš„<strong>å‰æ</strong>æ˜¯æœ¬èº«çš„æ‹“æ‰‘ç»“æ„ä¸å˜</li><li>è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Ÿ<ul><li>å¯ä»¥å­˜ä¸‹æ¥æ•°æ®ç»“æ„çš„æ‰€æœ‰å†å²ç‰ˆæœ¬</li><li>æ ¸å¿ƒæ€æƒ³<ul><li>åªè®°å½•æ¯ä¸ªç‰ˆæœ¬ä¸å‰ä¸€ä¸ªç‰ˆæœ¬ä¸åŒçš„åœ°æ–¹</li></ul></li></ul></li></ul><h3 id="æœ€å¤§å¼‚æˆ–å’Œ-ğŸŒ¸ğŸŒ¸ğŸŒ¸"><a href="#æœ€å¤§å¼‚æˆ–å’Œ-ğŸŒ¸ğŸŒ¸ğŸŒ¸" class="headerlink" title="æœ€å¤§å¼‚æˆ–å’Œ ğŸŒ¸ğŸŒ¸ğŸŒ¸"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMTI3OS8=">æœ€å¤§å¼‚æˆ–å’Œ</span> ğŸŒ¸ğŸŒ¸ğŸŒ¸</h3><ul><li>å¯æŒä¹…åŒ– $trie$ æ ‘</li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9zb2x1dGlvbi9jb250ZW50LzQ2NTM0Lw==">è¯¦ç»†é¢˜è§£</span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9zb2x1dGlvbi9jb250ZW50LzUxNDE5Lw==">ä»£ç è¯¦è§£</span></li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 600010, M = N * 25;
int n, m;
int s[N];
int tr[M][2];
int max_id[M];
int root[N], idx;
// iæ˜¯ç¬¬iä¸ªæ’å…¥çš„æ•°çš„i, pæ˜¯ä¸Šä¸€ä¸ªæ’å…¥çš„æ•°çš„èŠ‚ç‚¹å·, qæ˜¯å½“å‰èŠ‚ç‚¹å·, kæ˜¯ç°åœ¨å–åˆ°ç¬¬kä½
void insert(int i, int k, int p, int q)&#123;
    if(k &lt; 0)&#123;
        max_id[q] = i;  // è®°å½•å½“å‰èŠ‚ç‚¹(å¯èƒ½ä¼šè¢«åé¢å…¬ç”¨)æ‰€èƒ½åˆ°è¾¾çš„æœ€å¤§èŒƒå›´i
        return;
    &#125;
    int v = s[i] &gt;&gt; k &amp; 1;
    if(p) tr[q][v ^ 1] = tr[p][v ^ 1];  // ç›¸å½“äºå¤åˆ¶
    tr[q][v] = ++idx;
    insert(i, k - 1, tr[p][v], tr[q][v]);
    max_id[q] = max(max_id[tr[q][0]], max_id[tr[q][1]]);
&#125;
int query(int r, int C, int L)&#123;
    int p = r;
    for(int i = 23; i &gt;= 0; i--)&#123;
        int v = C &gt;&gt; i &amp; 1;
        if(max_id[tr[p][v ^ 1]] &gt;= L) p = tr[p][v ^ 1];
        else p = tr[p][v];
    &#125;
    return C ^ s[max_id[p]];
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n &gt;&gt; m;
    max_id[0] = -1;
    root[0] = ++idx;
    insert(0, 23, 0, root[0]);
    for(int i = 1; i &lt;= n; i++)&#123;
        int x;
        cin &gt;&gt; x;
        s[i] = s[i - 1] ^ x;
        root[i] = ++idx;
        insert(i, 23, root[i - 1], root[i]);
    &#125;
    char op;
    int l, r, x;
    while(m--)&#123;
        cin &gt;&gt; op;
        if(op == &#39;A&#39;)&#123;
            cin &gt;&gt; x;
            n++;
            s[n] = s[n - 1] ^ x;
            root[n] = ++idx;
            insert(n, 23, root[n - 1], root[n]);
        &#125;else&#123;
            cin &gt;&gt; l &gt;&gt; r &gt;&gt; x;
            cout &lt;&lt; query(root[r - 1], x ^ s[n], l - 1) &lt;&lt; endl;
        &#125;
    &#125;
&#125;
</code></pre><h3 id="ç¬¬kå°æ•°-ğŸŒ¸ğŸŒ¸ğŸŒ¸"><a href="#ç¬¬kå°æ•°-ğŸŒ¸ğŸŒ¸ğŸŒ¸" class="headerlink" title="ç¬¬kå°æ•° ğŸŒ¸ğŸŒ¸ğŸŒ¸"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9wcm9ibGVtL2NvbnRlbnQvMjU3Lw==">ç¬¬kå°æ•°</span> ğŸŒ¸ğŸŒ¸ğŸŒ¸</h3><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aW5nLmNvbS9zb2x1dGlvbi9jb250ZW50LzUxNDU2Lw==">é¢˜è§£</span></li><li>å¯æŒä¹…åŒ–çº¿æ®µæ ‘<ul><li>éš¾ä»¥è¿›è¡ŒåŒºé—´ä¿®æ”¹æ“ä½œ</li></ul></li><li>ç¦»æ•£åŒ–</li><li>åœ¨æ•°å€¼ä¸Šå»ºç«‹çº¿æ®µæ ‘ï¼Œç»´æŠ¤æ¯ä¸ªæ•°å€¼åŒºé—´ä¸­ä¸€å…±æœ‰å¤šå°‘ä¸ªæ•°</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 100010, M = 10010;
int n, m;
int a[N];
vector&lt;int&gt; nums;
struct Node&#123;
    int l, r;
    int cnt;
&#125;tr[N * 4 + N * 17];
int root[N], idx;

int find(int x)&#123;
    return lower_bound(nums.begin(), nums.end(), x) - nums.begin();
&#125;
int build(int l, int r)&#123;
    int p = ++idx;
    if(l == r) return p;
    int mid = l + r &gt;&gt; 1;
    tr[p].l = build(l, mid), tr[p].r = build(mid + 1, r);
    return p;
&#125;
int insert(int p, int l, int r, int x)&#123;
    int q = ++idx;
    tr[q] = tr[p];
    if(l == r)&#123;
        tr[q].cnt++;
        return q;
    &#125;
    int mid = l + r &gt;&gt; 1;
    if(x &lt;= mid) tr[q].l = insert(tr[p].l, l, mid, x);
    else tr[q].r = insert(tr[p].r, mid + 1, r, x);
    tr[q].cnt = tr[tr[q].l].cnt + tr[tr[q].r].cnt;
    return q;
&#125;
int query(int q, int p, int l, int r, int k)&#123;
    if(l == r) return r;
    int cnt = tr[tr[q].l].cnt - tr[tr[p].l].cnt;
    int mid = l + r &gt;&gt; 1;
    if(k &lt;= cnt) return query(tr[q].l, tr[p].l, l, mid, k);
    else return query(tr[q].r, tr[p].r, mid + 1, r, k - cnt);
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n &gt;&gt; m;
    for(int i = 1; i &lt;= n; i++)&#123;
        cin &gt;&gt; a[i];
        nums.push_back(a[i]);
    &#125;
    sort(nums.begin(), nums.end());
    nums.resize(unique(nums.begin(), nums.end()) - nums.begin());
    root[0] = build(0, nums.size() - 1);
    for(int i = 1; i &lt;= n; i++)&#123;
        root[i] = insert(root[i - 1], 0, nums.size() - 1, find(a[i]));
    &#125;
    while(m--)&#123;
        int l, r, k;
        cin &gt;&gt; l &gt;&gt; r &gt;&gt; k;
        cout &lt;&lt; nums[query(root[r], root[l - 1], 0, nums.size() - 1, k)] &lt;&lt; endl;
    &#125;
&#125;
</code></pre><h3 id="å¯æŒä¹…åŒ–çº¿æ®µæ ‘æ¨¡æ¿"><a href="#å¯æŒä¹…åŒ–çº¿æ®µæ ‘æ¨¡æ¿" class="headerlink" title="å¯æŒä¹…åŒ–çº¿æ®µæ ‘æ¨¡æ¿"></a>å¯æŒä¹…åŒ–çº¿æ®µæ ‘æ¨¡æ¿</h3><ul><li>ä¾‹é¢˜ï¼šåŒºé—´ k ä¸ªæ•°æœ€å¤§å’Œ</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 200010, M = 20010;
int n, m, k, x;
int a[N];
vector&lt;int&gt; nums;
struct Node&#123;
    int l, r, cnt;
    LL sum, val;        // cnt è®°å½•å‡ºç°æ¬¡æ•°ï¼Œsum è®°å½•å’Œï¼Œval è®°å½•å€¼
&#125;tr[N * 40];
int root[N], idx;

int find(int x)&#123;
    return lower_bound(nums.begin(), nums.end(), x) - nums.begin();
&#125;
int build(int l, int r)&#123;
    int p = ++idx;
    if(l == r) return p;
    int mid = l + r &gt;&gt; 1;
    tr[p].l = build(l, mid), tr[p].r = build(mid + 1, r);
    return p;
&#125;
int insert(int p, int l, int r, int x, int val)&#123;
    int q = ++idx;
    tr[q] = tr[p];
    tr[q].cnt++, tr[q].sum += val;
    if(l == r)&#123;
        tr[q].val = val;
        return q;
    &#125;
    int mid = l + r &gt;&gt; 1;
    if(x &lt;= mid) tr[q].l = insert(tr[p].l, l, mid, x, val);
    else tr[q].r = insert(tr[p].r, mid + 1, r, x, val);
    return q;
&#125;
// æŸ¥è¯¢å‰ k å¤§å€¼ï¼Œå› ä¸ºèŠ‚ç‚¹å­˜çš„æ˜¯å€¼ï¼Œæ‰€ä»¥æ‰¾å¤§çš„ï¼Œå…ˆä»å³è¾¹æ‰¾ã€‚
LL query(int q, int p, int l, int r, int k)&#123;
    if(l == r) return tr[q].val * k;    // å› ä¸ºä¸€ä¸ªå€¼å¯èƒ½å‡ºç°å¤šæ¬¡ï¼Œé‚£ä¹ˆè®¡ç®—ç­”æ¡ˆçš„æ—¶å€™è¦æŠŠä»–ä»¬éƒ½ç®—ä¸Š
    int cnt = tr[tr[q].r].cnt - tr[tr[p].r].cnt;
    int mid = l + r &gt;&gt; 1;
    if(k &lt;= cnt) return query(tr[q].r, tr[p].r, mid + 1, r, k);
    else return query(tr[q].l, tr[p].l, l, mid, k - cnt) + tr[tr[q].r].sum - tr[tr[p].r].sum;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k &gt;&gt; x;
    for(int i = 1; i &lt;= n; i++)&#123;
        cin &gt;&gt; a[i];
        nums.push_back(a[i]);
    &#125;
    for(int i = 1; i &lt; nums.size(); i++)&#123;
        nums[i] += nums[i - 1];
    &#125;
/*     sort(nums.begin(), nums.end());
    nums.resize(unique(nums.begin(), nums.end()) - nums.begin()); */
    root[0] = build(0, nums.size() - 1);
    for(int i = 1; i &lt;= n; i++)&#123;
        root[i] = insert(root[i - 1], 0, nums.size() - 1, find(a[i]), a[i]);
    &#125;
    while(m--)&#123;
        int l, r;
        cin &gt;&gt; l &gt;&gt; r;
        if(nums[query(root[r], root[l - 1], 0, nums.size() - 1, k)] &gt;= x)&#123;
            cout &lt;&lt; &quot;Y\n&quot;;
        &#125;else&#123;
            cout &lt;&lt; &quot;N\n&quot;;
        &#125;
    &#125;
&#125;
</code></pre><h3 id="åŠ¨æ€å¼€ç‚¹å¯æŒä¹…åŒ–çº¿æ®µæ ‘"><a href="#åŠ¨æ€å¼€ç‚¹å¯æŒä¹…åŒ–çº¿æ®µæ ‘" class="headerlink" title="åŠ¨æ€å¼€ç‚¹å¯æŒä¹…åŒ–çº¿æ®µæ ‘"></a>åŠ¨æ€å¼€ç‚¹å¯æŒä¹…åŒ–çº¿æ®µæ ‘</h3><ul><li>ä¾‹é¢˜ä¸º åŒºé—´ç¬¬ k å°</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 1e5 + 10, INF = 1e9;
struct Node&#123;
    int l, r;
    int cnt;
&#125;tr[N &lt;&lt; 5];
int n, m, idx , root[N], a[N];

void insert(int &amp;u, int v, int l, int r, int x)&#123;
    u = ++ idx;
    tr[u] = tr[v];
    tr[u].cnt ++ ;
    if(l == r) return ;
    int mid = l + r &gt;&gt; 1;
    if(x &lt;= mid) insert(tr[u].l, tr[v].l, l, mid, x);
    else insert(tr[u].r, tr[v].r, mid + 1, r, x);
&#125;

int query(int p, int q, int l, int r, int k)&#123;
    if(l == r) return l;
    int cnt = tr[tr[q].l].cnt - tr[tr[p].l].cnt;
    int mid = l + r &gt;&gt; 1;
    if(k &lt;= cnt) return query(tr[p].l, tr[q].l, l, mid, k);
    if(k &gt; cnt) return query(tr[p].r, tr[q].r, mid + 1, r, k - cnt);
&#125;

int main()&#123;
    cin.tie(0)-&gt;sync_with_stdio(0);
    cin &gt;&gt; n &gt;&gt; m;
    for(int i = 1 ; i &lt;= n ; i ++ )&#123;
        cin &gt;&gt; a[i];
        insert(root[i], root[i - 1], -INF, INF, a[i]);
    &#125;
    for(int i = 1 ; i &lt;= m ; i ++ )&#123;
        int l, r, k;
        cin &gt;&gt; l &gt;&gt; r &gt;&gt; k;
        cout &lt;&lt; query(root[l - 1], root[r], -INF, INF, k) &lt;&lt; endl;
    &#125;
    
    return 0;
&#125;
</code></pre><h2 id="Treap-å¹³è¡¡æ ‘"><a href="#Treap-å¹³è¡¡æ ‘" class="headerlink" title="Treap - å¹³è¡¡æ ‘"></a>Treap - å¹³è¡¡æ ‘</h2><ul><li>Binary Search Tree + heap<ul><li>BSTï¼Œå½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸­çš„ä»»ä½•ä¸€ä¸ªç‚¹çš„æƒå€¼å°äºå½“å‰èŠ‚ç‚¹çš„æƒå€¼ï¼›å½“å‰èŠ‚ç‚¹çš„å³å­æ ‘ä¸­çš„ä»»ä½•ä¸€ä¸ªç‚¹çš„æƒå€¼å¤§äºå½“å‰èŠ‚ç‚¹çš„æƒå€¼<ul><li>åŠ¨æ€ç»´æŠ¤æœ‰åºåºåˆ—</li></ul></li></ul></li><li>æ”¯æŒæ’å…¥ã€åˆ é™¤ã€æ‰¾å‰é©±&#x2F;åç»§ã€æœ€å¤§&#x2F;æœ€å°ã€æ±‚æŸä¸ªå€¼çš„æ’åã€æ±‚æ’åæ˜¯ $k$ çš„æ•°æ˜¯å“ªä¸ªã€æ¯”æŸä¸ªæ•°å°çš„æœ€å¤§å€¼ã€æ¯”æŸä¸ªæ•°å¤§çš„æœ€å°å€¼</li></ul><h3 id="AcWing-æ™®é€šå¹³è¡¡æ ‘"><a href="#AcWing-æ™®é€šå¹³è¡¡æ ‘" class="headerlink" title="AcWing|æ™®é€šå¹³è¡¡æ ‘"></a><a href="">AcWing|æ™®é€šå¹³è¡¡æ ‘</a></h3><ul><li>æ¨¡æ¿</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 1e5 + 10, INF = 0x3f3f3f3f;
struct Node&#123;
    int l, r;
    int key;    // äºŒå‰æœç´¢æ ‘æƒå€¼
    int val;    // å¤§æ ¹å †çš„éšæœºæƒå€¼
    int cnt, sz;
&#125;tr[N];

// Treap åœ¨ä»¥å…³é”®ç æ„æˆäºŒå‰æœç´¢æ ‘çš„åŒæ—¶, è¿˜æ»¡è¶³å †çš„æ€§è´¨, ä¸”å †çš„æƒé‡éšæœº, è¿™ä½¿å¾— Treap çš„æœŸæœ›å¤æ‚åº¦æ˜¯ log n

int root, idx, n;
// æ›´æ–°çˆ¶èŠ‚ç‚¹ sz ä¿¡æ¯
void pushup(int p)&#123;
    tr[p].sz = tr[tr[p].l].sz + tr[tr[p].r].sz + tr[p].cnt;
&#125;
// åˆ›å»ºä¸€ä¸ªå¶èŠ‚ç‚¹
int get_node(int key)&#123;
    tr[++idx].key = key;
    tr[idx].val = rand();
    tr[idx].cnt = tr[idx].sz = 1;
    return idx;
&#125;
//åˆå§‹åŒ–å¹³è¡¡æ ‘ å·¦å³å“¨å…µ 
//å¦‚æœæŸ¥è¯¢çš„ç»“æœå¯èƒ½ä¸å­˜åœ¨ï¼Œé‚£åŠ ä¸Šå“¨å…µä¹‹åå¯ä»¥ä¿è¯æŸ¥è¯¢çš„ç»“æœä¸€å®šå­˜åœ¨ï¼Œå°±ä¸éœ€è¦åœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­ç‰¹åˆ¤æ— è§£
void build()&#123;
    get_node(-INF), get_node(INF);
    root = 1, tr[1].r = 2;
    pushup(root);
&#125;
// å³æ—‹
void zig(int &amp;p)&#123;
    // æ ¹å˜äº†, ä¼ å¼•ç”¨
    // æ—‹è½¬çš„æ—¶å€™ä¼  root, root ä¼šå˜åŒ–,æˆ‘ä»¬å¸Œæœ› root è¿˜æ˜¯çœŸæ­£çš„ root, æ•…ç”¨ root
    // p å§‹ç»ˆæŒ‡å‘æ ¹
    int q = tr[p].l;
    tr[p].l = tr[q].r;
    tr[q].r = p;
    p = q;
    pushup(tr[p].r);
    pushup(p);
    // ä¸éœ€è¦æ›´æ–° p æ˜¯å› ä¸ºçœ‹ç€å³æ—‹å›¾, å³æ—‹ä¹‹å‰ y å·¦æ˜¯ A + B , y å³æ˜¯ C, æ—‹è¿‡ä¹‹åå®é™…ä¸Š y å·¦æ˜¯ A, y å³æ˜¯ B + C,
    // ä½†æ˜¯ä¸æ›´æ–° p,ç”±äºæœ‰ tr[q].r = p, ç›¸å½“äº y çš„ size ç”±å·¦ä¾§çš„ A + B å’Œå³ä¾§çš„ C æ„æˆ, ä¸å½±å“æœ€ç»ˆ size
    // ä½†æ˜¯ p çš„ r è¦æ›´æ–°, å› ä¸º r ç”± B å’Œ C æ„æˆ( r æ—‹å‰åªæœ‰ C )
&#125;
// å·¦æ—‹
void zag(int &amp;p)&#123;
    int q = tr[p].r;
    tr[p].r = tr[q].l;
    tr[q].l = p;
    p = q;
    pushup(tr[p].l);
    pushup(p);
&#125;
// æ’å…¥å€¼ key, ä»æ ¹å¼€å§‹
void insert(int &amp;p, int key)&#123;   // p æ˜¯æ¯ä¸€å±‚æ ¹èŠ‚ç‚¹çš„æŒ‡é’ˆ
    if(!p) p = get_node(key);
    else if(tr[p].key == key) tr[p].cnt++;
    else if(tr[p].key &gt; key)&#123;
        // å½“å‰èŠ‚ç‚¹å€¼å¤§äº key, è¯´æ˜åº”è¯¥åœ¨å·¦å­æ ‘æ’å…¥
        insert(tr[p].l, key);
        // ç”±äºåœ¨å·¦å­æ ‘æ’å…¥, æ’å…¥å·¦ä¾§åå·¦å­æ ‘ val å¯èƒ½å¤§äºæ ¹èŠ‚ç‚¹, å·¦å¤§å³æ—‹, ä¿è¯å †çš„æ€§è´¨
        if(tr[tr[p].l].val &gt; tr[p].val) zig(p);
    &#125;else&#123;
        insert(tr[p].r, key);
        if(tr[tr[p].r].val &gt; tr[p].val) zag(p);
    &#125;
    pushup(p);  // p æ˜¯æ¯ä¸€å±‚çš„æ ¹çš„æŒ‡é’ˆ, è‡ªåº•å‘ä¸Šæ›´æ–° p   
&#125;
void remove(int &amp;p, int key)&#123;
    if(!p) return ;
    if(tr[p].key == key)&#123;
        if(tr[p].cnt &gt; 1) tr[p].cnt--;
        else if(tr[p].l || tr[p].r)&#123;
            // å½“å‰èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå¯ä»¥ä¸”æœ‰å·¦å„¿å­æˆ–å³å„¿å­
            if(!tr[p].r || tr[tr[p].l].val &gt; tr[tr[p].r].val)&#123;
                // åªå­˜åœ¨å·¦å„¿å­(å·¦ val &gt; å³ val_0) æˆ–å·¦ val &gt; å³ val 
                zig(p);
                remove(tr[p].r, key);
            &#125;else&#123;
                // è‹¥å­˜åœ¨å³å„¿å­ä¸”å·¦val&lt;å³val 
                // å·¦å„¿å­ä¹Ÿå¯èƒ½ä¸å­˜åœ¨, ä¸å­˜åœ¨çš„è¯å·¦å„¿å­çš„ val å°±æ˜¯ 0 , è‚¯å®š &lt;= å³å„¿å­çš„ val ( val æœ€å°ä¸º 0 ), è¿™ä¸ªæ¨¡æ¿éšå«äº†åˆ¤å­˜åœ¨æ“ä½œ
                zag(p);
                remove(tr[p].l, key);
            &#125;
        &#125;else&#123;
            // ä¸å­˜åœ¨å·¦å³å­æ ‘,æ˜¯å¶å­èŠ‚ç‚¹
            p = 0;
        &#125;
    &#125;else if(tr[p].key &gt; key) remove(tr[p].l, key);
    else remove(tr[p].r, key);
    pushup(p);
&#125;
// æ²¡æœ‰ä¿®æ”¹,ä¸éœ€è¦å¼•ç”¨
// é€šè¿‡æ•°å€¼æ‰¾æ’å
int get_rank_by_key(int p, int key)&#123;
    if(!p) return 0;
    if(tr[p].key == key) return tr[tr[p].l].sz + 1; //å·¦å­æ ‘çš„ size + 1 (åŒæ ·çš„æ•°å€¼ä¸­æœ€é å·¦çš„)
    if(tr[p].key &gt; key) return get_rank_by_key(tr[p].l, key);
    return tr[tr[p].l].sz + tr[p].cnt + get_rank_by_key(tr[p].r, key); // å»å³è¾¹æ‰¾çš„æ—¶å€™æ‰¾çš„æ˜¯åœ¨å³å­æ ‘ä¸­çš„æ’å, éœ€è¦åŠ ä¸Šå·¦å­æ ‘å’Œæ ¹çš„ cnt
&#125;
// é€šè¿‡æ’åæ‰¾æ•°å€¼
int get_key_by_rank(int p, int rank)&#123;
    if(!p) return INF;
    if(tr[tr[p].l].sz &gt;= rank) return get_key_by_rank(tr[p].l, rank); // å·¦è¾¹çš„ä¸ªæ•° &gt;=rank, è¯´æ˜æ•°å€¼åœ¨å·¦è¾¹
    if(tr[tr[p].l].sz + tr[p].cnt &gt;= rank) return tr[p].key;
    return get_key_by_rank(tr[p].r, rank - tr[tr[p].l].sz - tr[p].cnt); // å»å³å­æ ‘ä¸­æ‰¾æ•°å€¼, æ’ååº”è¯¥å…ˆå‡å»å·¦å­æ ‘ size + cnt
&#125;
// æ‰¾åˆ°ä¸¥æ ¼å°äºkeyçš„æœ€å¤§æ•°
int get_prev(int p, int key)&#123;
    if(!p) return -INF;
    if(tr[p].key &gt;= key) return get_prev(tr[p].l, key); // å½“å‰å¤§äº key, å³å­æ ‘ä¸è€ƒè™‘
    return max(tr[p].key, get_prev(tr[p].r, key));  // å·¦å­æ ‘éƒ½å°äº key æ‰€ä»¥ä¸å¦‚ key æ›´å¥½, æ‰€ä»¥è€ƒè™‘å½“å‰ key å’Œå³å­æ ‘

&#125;
// æ‰¾åˆ°ä¸¥æ ¼å¤§äºkeyçš„æœ€å°æ•°
int get_next(int p, int key)&#123;
    if(!p) return INF;
    if(tr[p].key &lt;= key)return get_next(tr[p].r, key); // å½“å‰å°äºkey, å·¦å­æ ‘ä¸è€ƒè™‘
    return min(tr[p].key, get_next(tr[p].l, key)); // å³å­æ ‘éƒ½å¤§äº key æ‰€ä»¥ä¸å¦‚ key æ›´å¥½, æ‰€ä»¥è€ƒè™‘å½“å‰ key å’Œå·¦å­æ ‘
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    build();
    int n;
    cin &gt;&gt; n;
    while(n--)&#123;
        int op, x;
        cin &gt;&gt; op &gt;&gt; x;
        if(op == 1) insert(root, x);
        else if(op == 2) remove(root, x);
        else if(op == 3) cout &lt;&lt; get_rank_by_key(root, x) - 1 &lt;&lt; &#39;\n&#39;;
        else if(op == 4) cout &lt;&lt; get_key_by_rank(root, x + 1) &lt;&lt; &#39;\n&#39;;
        else if(op == 5) cout &lt;&lt; get_prev(root, x) &lt;&lt; &#39;\n&#39;;
        else cout &lt;&lt; get_next(root, x) &lt;&lt; &#39;\n&#39;;
    &#125;
&#125;
</code></pre><h2 id="Splay-å¹³è¡¡æ ‘"><a href="#Splay-å¹³è¡¡æ ‘" class="headerlink" title="Splay å¹³è¡¡æ ‘"></a>Splay å¹³è¡¡æ ‘</h2><pre><code class="cpp">å¹³è¡¡äºŒå‰æ ‘
set/map çº¢é»‘æ ‘(ä»£ç é•¿) == splay(ä»£ç é€‚ä¸­,æ”¯æŒå¾ˆå¤šæ“ä½œ)
treap(æœ‰å±€é™,ä¸€äº›æ“ä½œåšä¸äº†)
AVL
å¤šå‰æ ‘
Bæ ‘ B+æ ‘

æ“ä½œ:
    å·¦æ—‹ 
    å³æ—‹ (ç»´æŠ¤çš„æ˜¯ä¸­åºéå†ä¸å˜)
             å³æ—‹
              -&gt;
         z           z
        /           //
       y           x    
      / \         / \\
     x   c       A   y
    / \            // \
   A   B           B   C
   AxByc           AxByc
             å·¦æ—‹
              -&gt;
   =çº¿ä»£è¡¨å˜å¾—å…³ç³»
   -ä»£è¡¨ä¸å˜çš„å…³ç³»
   å¯ä»¥å‘ç°ç”±äºè¦ç»´æŠ¤ä¸­åºéå†,æœ€å·¦å’Œæœ€å³çš„å…³ç³»æ˜¯ä¸å˜çš„
    æ’å…¥
    æŸ¥è¯¢
 æ¯æ“ä½œä¸€ä¸ªèŠ‚ç‚¹ å‡å°†è¯¥èŠ‚ç‚¹æ—‹è½¬åˆ°æ ‘æ ¹
splay(x,k) å°†ç‚¹xæ—‹è½¬è‡³ç‚¹kä¸‹
1   
       z      y    x
      /      / \    \ 
     y      x   z    y
    /                 \
   x                   z    
        å…ˆè½¬y     è½¬x
    æ¯è½¬ä¸€æ¬¡xå¾€ä¸Šèµ°ä¸¤æ ¼ ç›´åˆ°æŸä¸ªç‚¹ä¸‹é¢ä¸ºæ­¢
2     z       z   x
     /       /   / \
    y       x   y   z
     \     /
      x   y
       å…ˆè½¬x     è½¬x

æ’å…¥
1  æ‰¾åˆ°xæ’å…¥ä½ç½®
   æŠŠxè½¬åˆ°æ ¹
2  å°†ä¸€ä¸ªåºåˆ—æ’åˆ°yçš„åé¢
    ---------------
            y z
    2.1 æ‰¾yçš„åç»§z 
    2.2 å°†yè½¬åˆ°æ ¹       splay(y,0)
    2.3 å°†zè½¬åˆ°yçš„ä¸‹é¢  spaly(z,y)
   y
    \
     z
    /
  null(å› ä¸ºzå’Œyä¹‹é—´æ²¡æœ‰æ•°,æ‰€ä»¥zå·¦å­æ ‘ä¸ºç©º) 
   2.4 å°†åºåˆ—æ’å…¥åˆ°zçš„å·¦å­æ ‘ 
åˆ é™¤
   -----------------
     L-1 L   R R+1
   1 å°†L-1è½¬åˆ°æ ¹èŠ‚ç‚¹
   2 å°†R+1è½¬åˆ°L-1ä¸‹é¢
   æ­¤æ—¶R+1çš„å·¦å­æ ‘=[L,R]
   3 å°†R+1çš„å·¦å„¿å­ç½®ä¸ºç©ºNull
æœ¬é¢˜
ç»´æŠ¤ä¿¡æ¯
   1 å­æ ‘æ€»ç‚¹æ•° size ç”¨äºé€’å½’æŸ¥æ‰¾ä½ç½®
   2 æ‡’æ ‡è®°     flag æ•´ä¸ªåŒºé—´æ˜¯å¦éœ€è¦ç¿»è½¬

pushup(u)ç”¨ä¸¤ä¸ªå„¿å­ä¿¡æ¯ç»´æŠ¤æ ¹èŠ‚ç‚¹ä¿¡æ¯
  tr[u].size = tr[u&lt;&lt;1].size+tr[u&lt;&lt;1|1].size
å†™åœ¨æ—‹è½¬æœ€å

pushdown(u)ä¸‹ä¼ æ‡’æ ‡è®°,å…ˆæ›´æ–°å­æ ‘
    swap(tr[u&lt;&lt;1],tr[u&lt;&lt;1|1])(è¦ç¿»è½¬æ•´é¢—å­æ ‘ï¼Œè¦å…ˆæŠŠå·¦å³ä¸¤ä¸ªå„¿å­ç¿»è½¬ï¼Œç„¶åé€’å½’ç¿»è½¬å·¦å³ä¸¤æ£µå­æ ‘)
    å°†æ ‡è®°ä¸‹ä¼  t[u&lt;&lt;1] = t[u&lt;&lt;1|1] = t[u]
    å°†å½“å‰æ ‡è®°æ¸…ç©º  t[u] = 0
å†™åœ¨é€’å½’ä¹‹å‰

splayä¿è¯ä¸­åºéå†æ˜¯å½“å‰åºåˆ—çš„é¡ºåº



--------------------------------------------------------------------------
#include &lt;cstdio&gt;
#include &lt;cstring&gt;
#include &lt;iostream&gt;
#include &lt;algorithm&gt;

using namespace std;

const int N = 100010;

int n, m;
struct Node
&#123;
    int s[2], p, v;//å„¿å­,çˆ¶èŠ‚ç‚¹,ç¼–å·
    int size, flag;//å­æ ‘èŠ‚ç‚¹ä¸ªæ•°, æœ‰æ²¡æœ‰ç¿»è½¬

    void init(int _v, int _p)
    &#123;
        v = _v, p = _p;
        size = 1;
    &#125;
&#125;tr[N];
int root, idx;

void pushup(int x)
&#123;
    tr[x].size = tr[tr[x].s[0]].size + tr[tr[x].s[1]].size + 1;
&#125;

void pushdown(int x)
&#123;
    // å¦‚æœå½“å‰å­æ ‘éœ€è¦ç¿»è½¬ 48.34
    if (tr[x].flag)
    &#123;
        //è¦ç¿»è½¬æ•´é¢—å­æ ‘ï¼Œè¦å…ˆæŠŠå·¦å³ä¸¤ä¸ªå„¿å­ç¿»è½¬ï¼Œç„¶åé€’å½’ç¿»è½¬å·¦å³ä¸¤æ£µå­æ ‘
        swap(tr[x].s[0], tr[x].s[1]);
        tr[tr[x].s[0]].flag ^= 1;//ç¿»è½¬æ ‡è®°å¾€ä¸‹ä¼ 
        tr[tr[x].s[1]].flag ^= 1;//ç¿»è½¬æ ‡è®°å¾€ä¸‹ä¼ 
        tr[x].flag = 0;//å½“å‰æ ‡è®°æ¸…ç©º
    &#125;
&#125;

/*
          z
         /
        y
       /
      x  
    k=0è¡¨ç¤ºxæ˜¯yçš„å·¦å„¿å­ï¼›k=1è¡¨ç¤ºxæ˜¯yçš„å³å„¿å­
         z           z
        /           //   --1
       y           x    
      / \         / \\   --2
     x   c       A   y
    / \      3--   // \
   A   B           B   C 
   AxByc           AxByc
             å·¦æ—‹
              -&gt;
   =çº¿ä»£è¡¨å˜å¾—å…³ç³»
   -ä»£è¡¨ä¸å˜çš„å…³ç³»
   å¯ä»¥å‘ç°ç”±äºè¦ç»´æŠ¤ä¸­åºéå†,æœ€å·¦å’Œæœ€å³çš„å…³ç³»æ˜¯ä¸å˜çš„
   ä½“ç°åœ¨rotateä¸­å°±ä¸‰æ¡è¾¹
   kä»£è¡¨å·¦,k^1ä»£è¡¨å³
*/
void rotate(int x)
&#123;
    int y = tr[x].p, z = tr[y].p;
    int k = tr[y].s[1] == x;  // k=0è¡¨ç¤ºxæ˜¯yçš„å·¦å„¿å­ï¼›k=1è¡¨ç¤ºxæ˜¯yçš„å³å„¿å­
    tr[z].s[tr[z].s[1] == y] = x, tr[x].p = z;// è¾¹1 zåŸæ¥çš„å„¿å­yå˜ä¸ºx  xçš„çˆ¶èŠ‚ç‚¹å˜ä¸ºz
    tr[y].s[k] = tr[x].s[k ^ 1], tr[tr[x].s[k ^ 1]].p = y;// è¾¹3 yçš„å·¦å„¿å­å˜ä¸ºxçš„å³å„¿å­B,xçš„å³å„¿å­çš„çˆ¶èŠ‚ç‚¹å˜ä¸ºy
    tr[x].s[k ^ 1] = y, tr[y].p = x;// è¾¹2 xçš„å³å„¿å­å˜ä¸ºy,yçš„çˆ¶èŠ‚ç‚¹å˜ä¸ºx
    pushup(y), pushup(x);// A,B,Cä¸‰ä¸ªç‚¹ä¿¡æ¯æ²¡å˜,ä½†x,yå­æ ‘ä¿¡æ¯å˜äº†,åˆyåœ¨xä¸‹é¢,æ‰€ä»¥å…ˆç»´æŠ¤æ›´æ–°yå­æ ‘,å†ç»´æŠ¤æ›´æ–°xå­æ ‘
&#125;
/*
1   
       z      y    x
      /      / \    \ 
     y      x   z    y
    /                 \
   x                   z    
        å…ˆè½¬y     è½¬x
    æ¯è½¬ä¸€æ¬¡xå¾€ä¸Šèµ°ä¸¤æ ¼ ç›´åˆ°æŸä¸ªç‚¹ä¸‹é¢ä¸ºæ­¢
2     z       z   x
     /       /   / \
    y       x   y   z
     \     /
      x   y
       å…ˆè½¬x     è½¬x
*/
void splay(int x, int k)
&#123;
    while (tr[x].p != k)
    &#123;
        int y = tr[x].p, z = tr[y].p;
        if (z != k)
        // å¦‚æœæ˜¯æŠ˜çº¿å…³ç³»  ==  xæ˜¯yçš„å³/å·¦å„¿å­ ä¸” yæ˜¯zçš„å·¦/å³å„¿å­  ä¸€0ä¸€1
            if ((tr[y].s[1] == x) ^ (tr[z].s[1] == y)) rotate(x);//æŠ˜çº¿rotateä¸¤æ¬¡x
            else rotate(y);//ç›´çº¿rotate ä¸€æ¬¡yä¸€æ¬¡x
        rotate(x);
    &#125;
    if (!k) root = x;//å¦‚æœk==0 æ ¹èŠ‚ç‚¹æ›´æ–°ä¸ºx
&#125;
// æŒ‰å¤§æ’å³ å°æ’å·¦çš„äºŒå‰æ ‘æ’æ³• æ’å…¥èŠ‚ç‚¹
void insert(int v)
&#123;
    int u = root, p = 0;
    while (u) p = u, u = tr[u].s[v &gt; tr[u].v];//ä¸€ç›´å¾€ä¸‹é€’å½’ç›´åˆ°uä¸ºnull
    u = ++ idx;
    if (p) tr[p].s[v &gt; tr[p].v] = u;//å¦‚æœæœ‰çˆ¶èŠ‚ç‚¹,çˆ¶èŠ‚ç‚¹å„¿å­ä¿¡æ¯æ›´æ–°ä¸ºu
    tr[u].init(v, p);//åˆå§‹åŒ–ç‚¹uçš„å€¼å’Œçˆ¶èŠ‚ç‚¹
    splay(u, 0);//æ’å…¥åå°†å½“å‰ç‚¹uè½¬åˆ°æ ¹èŠ‚ç‚¹ä¸Š
&#125;
/*
                 k
                / \
 tr[u&lt;&lt;1].size    
 å¦‚æœå·¦å­æ ‘ä¸ªæ•°&gt;=k åˆ™å»å·¦å­æ ‘é‡Œçœ‹
 å¦‚æœå·¦å­æ ‘ä¸ªæ•°=k-1,åˆ™uå°±æ˜¯ä¸­åºéå†ç¬¬kä¸ªç‚¹
 å¦åˆ™å»å³å­æ ‘é‡Œçœ‹,k-=tr[u&lt;&lt;1].size-1
*/
int get_k(int k)
&#123;
    int u = root;
    while (true)
    &#123;
        pushdown(u);
        if (tr[tr[u].s[0]].size &gt;= k) u = tr[u].s[0];
        else if (tr[tr[u].s[0]].size + 1 == k) return u;
        else k -= tr[tr[u].s[0]].size + 1, u = tr[u].s[1];
    &#125;
    return -1;//æ‰¾ä¸åˆ°è¿”å›-1
&#125;
//ä¸­åºéå†
void output(int u)
&#123;
    pushdown(u);
    // å¦‚æœuæœ‰å·¦å„¿å­ å…ˆé€’å½’è¾“å‡ºå·¦å„¿å­
    if (tr[u].s[0]) output(tr[u].s[0]);
    // å¦‚æœuä¸æ˜¯å“¨å…µè¾“å‡ºå½“å‰ç‚¹
    if (tr[u].v &gt;= 1 &amp;&amp; tr[u].v &lt;= n) printf(&quot;%d &quot;, tr[u].v);
    // å¦‚æœuæœ‰å³å„¿å­ é€’å½’è¾“å‡ºå³å„¿å­
    if (tr[u].s[1]) output(tr[u].s[1]);
&#125;

int main()
&#123;
    scanf(&quot;%d%d&quot;, &amp;n, &amp;m);
    for (int i = 0; i &lt;= n + 1; i ++ ) insert(i);//æ’å…¥å“¨å…µ 0,n+1 é˜²æ­¢L-1å’ŒR+1è¶Šç•Œ
    while (m -- )
    &#123;
        int l, r;
        scanf(&quot;%d%d&quot;, &amp;l, &amp;r);
        //å› ä¸ºå“¨å…µè¦ç¿»è½¬çš„ä»[L,R]å˜ä¸º[L+1,R+1] åˆ™è¦æ‰¾Lå’ŒR+2ä½œä¸ºL+1çš„å‰ç»§å’ŒR+1çš„åç»§
        l = get_k(l), r = get_k(r + 2);
        // å·¦ç«¯ç‚¹lè½¬åˆ°æ ¹,å³ç«¯ç‚¹rè½¬åˆ°å·¦ç«¯ç‚¹ä¸‹é¢
        splay(l, 0), splay(r, l);
        // åªè¦å°†rçš„å·¦å­æ ‘[L+1,R+1]ç¿»è½¬
        tr[tr[r].s[0]].flag ^= 1;
    &#125;
    output(root);
    return 0;
&#125;
</code></pre><h3 id="P3391-æ–‡è‰ºå¹³è¡¡æ ‘"><a href="#P3391-æ–‡è‰ºå¹³è¡¡æ ‘" class="headerlink" title="P3391 | æ–‡è‰ºå¹³è¡¡æ ‘"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cubHVvZ3UuY29tLmNuL3Byb2JsZW0vUDMzOTE=">P3391 | æ–‡è‰ºå¹³è¡¡æ ‘</span></h3><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 100010, INF = 0x3f3f3f3f;
struct Node&#123;
    int s[2], p, v;
    int sz, flag;
    void init(int _v, int _p)&#123;
        v = _v, p = _p;
        sz = 1;
    &#125;
&#125;tr[N];
int root, idx, n, m;

void pushup(int x)&#123;
    tr[x].sz = tr[tr[x].s[0]].sz + tr[tr[x].s[1]].sz + 1;
&#125;
void pushdown(int x)&#123;
    if(tr[x].flag)&#123;
        swap(tr[x].s[0], tr[x].s[1]);
        tr[tr[x].s[0]].flag ^= 1;
        tr[tr[x].s[1]].flag ^= 1;
        tr[x].flag = 0;
    &#125;
&#125;
void rotate(int x)&#123;
    int y = tr[x].p, z = tr[y].p;
    int k = tr[y].s[1] == x;
    tr[z].s[tr[z].s[1] == y] = x, tr[x].p = z;
    tr[y].s[k] = tr[x].s[k ^ 1], tr[tr[x].s[k ^ 1]].p = y;
    tr[x].s[k ^ 1] = y, tr[y].p = x;
    pushup(y), pushup(x);
&#125;
void splay(int x, int k)&#123;
    while(tr[x].p != k)&#123;
        int y = tr[x].p, z = tr[y].p;
        if(z != k)&#123;
            if((tr[y].s[1] == x) ^ (tr[z].s[1] == y)) rotate(x);
            else rotate(y);
        &#125;
        rotate(x);
    &#125;
    if(!k) root = x;
&#125;
void insert(int v)&#123;
    int u = root, p = 0;
    while(u)&#123;
        p = u, u = tr[u].s[v &gt; tr[u].v];
    &#125;
    u = ++idx;
    if(p) tr[p].s[v &gt; tr[p].v] = u;
    tr[u].init(v, p);
    splay(u, 0);
&#125;
int get_k(int k)&#123;
    int u = root;
    while(1)&#123;
        pushdown(u);
        if(tr[tr[u].s[0]].sz &gt;= k) u = tr[u].s[0];
        else if(tr[tr[u].s[0]].sz + 1 == k) return u;
        else k -= tr[tr[u].s[0]].sz + 1, u = tr[u].s[1];
    &#125;
    return -1;
&#125;
void output(int u)&#123;
    pushdown(u);
    if(tr[u].s[0]) output(tr[u].s[0]);
    if(tr[u].v &gt;= 1 &amp;&amp; tr[u].v &lt;= n) cout &lt;&lt; tr[u].v &lt;&lt; &quot; &quot;;
    if(tr[u].s[1]) output(tr[u].s[1]);
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    cin &gt;&gt; n &gt;&gt; m;
    for(int i = 0; i &lt;= n + 1; i++)&#123;
        insert(i);
    &#125;
    while(m--)&#123;
        int l, r;
        cin &gt;&gt; l &gt;&gt; r;
        l = get_k(l), r = get_k(r + 2);
        splay(l, 0), splay(r, l);
        tr[tr[r].s[0]].flag ^= 1;
    &#125;
    output(root);
&#125;
</code></pre><h3 id="P3369-æ™®é€šå¹³è¡¡æ ‘"><a href="#P3369-æ™®é€šå¹³è¡¡æ ‘" class="headerlink" title="P3369 | æ™®é€šå¹³è¡¡æ ‘"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cubHVvZ3UuY29tLmNuL3Byb2JsZW0vUDMzNjk=">P3369 | æ™®é€šå¹³è¡¡æ ‘</span></h3><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 1e5 + 10, INF = 0x3f3f3f3f;
struct Node&#123;
    int s[2], p, v;
    int sz, flag;
    int cnt;

    void init(int _v, int _p)&#123;
        v = _v, p = _p;
        sz = 1;
        cnt = 1;
    &#125;
&#125;tr[N];
int root, idx;
void pushup(int u)&#123;
    tr[u].sz = tr[tr[u].s[0]].sz + tr[tr[u].s[1]].sz + tr[u].cnt;
&#125;
void rotate(int x)&#123;
    int y = tr[x].p, z = tr[y].p;
    int k = tr[y].s[1] == x;
    tr[z].s[tr[z].s[1] == y] = x, tr[x].p = z;
    tr[y].s[k] = tr[x].s[k ^ 1], tr[tr[x].s[k ^ 1]].p = y;
    tr[x].s[k ^ 1] = y, tr[y].p = x;
    pushup(y), pushup(x);
&#125;
void splay(int x, int k)&#123;
    while(tr[x].p != k)&#123;
        int y = tr[x].p, z = tr[y].p;
        if(z != k)&#123;
            if((tr[y].s[1] == x) ^ (tr[z].s[1] == y)) rotate(x);
            else rotate(y);
        &#125;
        rotate(x);
    &#125;
    if(!k) root = x;
&#125;
void find(int x)&#123;
    int p = root;
    if(!p) return;
    while(tr[p].s[x &gt; tr[p].v] &amp;&amp; x != tr[p].v)&#123;
        p = tr[p].s[x &gt; tr[p].v];
    &#125;
    splay(p, 0);
&#125;
void insert(int x)&#123;
    int p = root, y = 0;
    while(p != 0 &amp;&amp; x != tr[p].v)&#123;
        y = p, p = tr[p].s[x &gt; tr[p].v];
    &#125;
    if(p != 0)&#123;
        tr[p].cnt++;
    &#125;else&#123;
        p = ++idx;
        if(y != 0) tr[y].s[x &gt; tr[y].v] = p;
        tr[p].init(x, y);
    &#125;
    splay(p, 0);
&#125;
int pre_next(int x, int st)&#123;
    find(x);
    int p = root;
    if(tr[p].v &gt; x &amp;&amp; st == 1)&#123;
        return p;
    &#125;
    if(tr[p].v &lt; x &amp;&amp; st == 0)&#123;
        return p;
    &#125;
    p = tr[root].s[st];
    while(tr[p].s[st ^ 1] != 0) p = tr[p].s[st ^ 1];
    return p;
&#125;
void remove(int x)&#123;
    int last = pre_next(x, 0);
    int next = pre_next(x, 1);
    splay(last, 0), splay(next, last);
    int k = tr[next].s[0];
    if(tr[k].cnt &gt; 1)&#123;
        tr[k].cnt--;
        splay(k, 0);
    &#125;else&#123;
        tr[next].s[0] = 0;
    &#125;
&#125;
int pos(int x)&#123;
    int p = root;
    if(tr[p].sz &lt; x)&#123;
        return -1;
    &#125;
    while(1)&#123;
        if(x &lt;= tr[tr[p].s[0]].sz)&#123;
            p = tr[p].s[0];
        &#125;else if(x &gt; tr[tr[p].s[0]].sz + tr[p].cnt)&#123;
            x -= tr[tr[p].s[0]].sz + tr[p].cnt;
            p = tr[p].s[1];
        &#125;else&#123;
            return p;
        &#125;
    &#125;
&#125;
int main()&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);
    int n;
    cin &gt;&gt; n;
    insert(-INF), insert(INF);
    for(int i = 1; i &lt;= n; i++)&#123;
        int op, num;
        cin &gt;&gt; op &gt;&gt; num;
        if(op == 1)&#123;
            insert(num);
        &#125;else if(op == 2)&#123;
            remove(num);
        &#125;else if(op == 3)&#123;
            find(num);
            cout &lt;&lt; tr[tr[root].s[0]].sz &lt;&lt; &#39;\n&#39;;
        &#125;else if(op == 4)&#123;
            cout &lt;&lt; tr[pos(num + 1)].v &lt;&lt; &#39;\n&#39;;
        &#125;else if(op == 5)&#123;
            cout &lt;&lt; tr[pre_next(num, 0)].v &lt;&lt; &#39;\n&#39;;
        &#125;else&#123;
            cout &lt;&lt; tr[pre_next(num, 1)].v &lt;&lt; &#39;\n&#39;;
        &#125;
    &#125;
&#125;
</code></pre><h3 id="POJ2828-Buy-Tickets"><a href="#POJ2828-Buy-Tickets" class="headerlink" title="POJ2828 | Buy Tickets"></a><span class="exturl" data-url="aHR0cHM6Ly92anVkZ2UubmV0L3Byb2JsZW0vUE9KLTI4MjgjYXV0aG9yPUhVQ00yMDE3MzI=">POJ2828 | Buy Tickets</span></h3><ul><li>é¢˜æ„<ul><li>æœ‰ $N$ ä¸ªäººæ’é˜Ÿï¼Œæ¯ä¸€ä¸ªäººéƒ½æœ‰ä¸€ä¸ª $val$ æ¥å¯¹åº”ï¼Œæ¯ä¸€ä¸ªåæ¥äººéƒ½ä¼šæ’å…¥å½“å‰é˜Ÿä¼çš„æŸä¸€ä¸ªä½ç½® $pos$ã€‚è¦æ±‚æŠŠé˜Ÿä¼æœ€åçš„çŠ¶æ€è¾“å‡ºã€‚</li></ul></li><li>åˆ†æ<ul><li>ç”¨ splay æ¨¡æ‹Ÿä¸€éå³å¯ã€‚</li></ul></li><li>ä»£ç </li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 2e5 + 10;
int n, m;
struct Node&#123;
    int s[2], p, v;
    int sz, flag;
    void init(int _v, int _p)&#123;
        v = _v, p = _p;
        sz = 1;
    &#125;
&#125;tr[N];
int root, idx;
void pushup(int x)&#123;
    tr[x].sz = tr[tr[x].s[0]].sz + tr[tr[x].s[1]].sz + 1;
&#125;
void pushdown(int x)&#123;
    if(tr[x].flag)&#123;
        swap(tr[x].s[0], tr[x].s[1]);
        tr[tr[x].s[0]].flag ^= 1;
        tr[tr[x].s[1]].flag ^= 1;
        tr[x].flag = 0;
    &#125;
&#125;
void rotate(int x)&#123;
    int y = tr[x].p, z = tr[y].p;
    int k = tr[y].s[1] == x;
    tr[z].s[tr[z].s[1] == y] = x, tr[x].p = z;
    tr[y].s[k] = tr[x].s[k ^ 1], tr[tr[x].s[k ^ 1]].p = y;
    tr[x].s[k ^ 1] = y, tr[y].p = x;
    pushup(y), pushup(x);
&#125;
void splay(int x, int k)&#123;
    while(tr[x].p != k)&#123;
        int y = tr[x].p, z = tr[y].p;
        if(z != k)&#123;
            if((tr[y].s[1] == x) ^ (tr[z].s[1] == y)) rotate(x);
            else rotate(y);
        &#125;
        rotate(x);
    &#125;
    if(!k) root = x;
&#125;
int get_k(int k)&#123;
    int u = root;
    while(1)&#123;
        //pushdown(u);
        if(tr[tr[u].s[0]].sz &gt;= k) u = tr[u].s[0];
        else if(tr[tr[u].s[0]].sz + 1 == k) return u;
        else k -= tr[tr[u].s[0]].sz + 1, u = tr[u].s[1];
    &#125;
    return -1;
&#125;
void insert(int x, int v)&#123;
    if(!root)&#123;
        root = ++idx;
        tr[root].init(v, 0);
        return;
    &#125;
    if(!x)&#123;
        int u = root;
        while(tr[u].s[0]) u = tr[u].s[0];
        tr[u].s[0] = ++idx;
        tr[idx].init(v, u);
        splay(idx, 0);
        return;
    &#125;
    int k = get_k(x);
    splay(k, 0);
    root = ++idx;
    tr[root].init(v, 0);
    tr[root].s[1] = tr[k].s[1];
    tr[tr[k].s[1]].p = root;
    tr[k].s[1] = 0;
    tr[root].s[0] = k;
    tr[k].p = root;
    pushup(k), pushup(root);
&#125;
void output(int u)&#123;
    //pushdown(u);
    if(tr[u].s[0]) output(tr[u].s[0]);
    printf(&quot;%d &quot;, tr[u].v);
    if(tr[u].s[1]) output(tr[u].s[1]);
&#125;
int main()&#123;
    while(~scanf(&quot;%d&quot;, &amp;n))&#123;
        root = idx = 0;
        memset(tr, 0, sizeof tr);
        for(int i = 1; i &lt;= n; i++)&#123;
            int t, x;
            scanf(&quot;%d %d&quot;, &amp;t, &amp;x);
            insert(t, x);
        &#125;
        output(root);
        puts(&quot;&quot;);
    &#125;
&#125;
</code></pre><h2 id="è«é˜Ÿ"><a href="#è«é˜Ÿ" class="headerlink" title="è«é˜Ÿ"></a>è«é˜Ÿ</h2><ul><li>å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vV0FNb25zdGVyL3AvMTAxMTg5MzQuaHRtbA==">è«é˜Ÿç®—æ³•â€”â€”ä»å…¥é—¨åˆ°é»‘é¢˜</span></li></ul><h3 id="æ™®é€šè«é˜Ÿ"><a href="#æ™®é€šè«é˜Ÿ" class="headerlink" title="æ™®é€šè«é˜Ÿ"></a>æ™®é€šè«é˜Ÿ</h3><ul><li>è§£å†³ä¸€æ®µåŒºé—´å†…ä¸åŒæ•°çš„ä¸ªæ•°</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 1e6 + 10;
inline int read()&#123;
    int x = 0, f = 1;
    char ch = getchar();
    while(!isdigit(ch))&#123;
        if(ch == &#39;-&#39;) f = -1;
        ch = getchar();
    &#125;
    while(isdigit(ch))&#123;
        x = x * 10 + ch - &#39;0&#39;;
        ch = getchar();
    &#125;
    return x * f;
&#125;
inline void write(int x)&#123;
    if(x &lt; 0)&#123;
        putchar(&#39;-&#39;);
        x = -x;
    &#125;
    if(x &gt; 9) write(x / 10);
    putchar(x % 10 + &#39;0&#39;);
&#125;
int sq;
struct query&#123;
    int l, r, id;
    // å¥‡å¶åŒ–æ’åº
    bool operator &lt; (const query &amp;o) const&#123;
        // è¿™é‡Œåªéœ€è¦çŸ¥é“æ¯ä¸ªå…ƒç´ å½’å±å“ªä¸ªå—ï¼Œè€Œå—çš„å¤§å°éƒ½æ˜¯ sqrt(n)ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨ l/sq
        if(l / sq != o.l / sq)&#123;
            return l &lt; o.l;
        &#125;
        if(l / sq &amp; 1)&#123;
            return r &lt; o.r;
        &#125;
        return r &gt; o.r;
    &#125;
&#125;Q[N];
int A[N], ans[N], cnt[N], cur, l = 1, r = 0;
inline void add(int p)&#123;
    if(cnt[A[p]] == 0)&#123;
        cur++;
    &#125;
    cnt[A[p]]++;
&#125;
inline void del(int p)&#123;
    cnt[A[p]]--;
    if(cnt[A[p]] == 0)&#123;
        cur--;
    &#125;
&#125;
int main()&#123;
    int n = read();
    sq = sqrt(n);
    for(int i = 1; i &lt;= n; i++)&#123;
        A[i] = read();
    &#125;
    int q = read();
    for(int i = 0; i &lt; q; i++)&#123;
        Q[i].l = read();
        Q[i].r = read();
        Q[i].id = i;
    &#125;
    sort(Q, Q + q);
    for(int i = 0; i &lt; q; i++)&#123;
        while(l &gt; Q[i].l) add(--l);
        while(r &lt; Q[i].r) add(++r);
        while(l &lt; Q[i].l) del(l++);
        while(r &gt; Q[i].r) del(r--);
        ans[Q[i].id] = cur;
    &#125;
    for(int i = 0; i &lt; q; i++)&#123;
        write(ans[i]);
        putchar(&#39;\n&#39;);
    &#125;
&#125;
</code></pre><h3 id="å¸¦ä¿®è«é˜Ÿ"><a href="#å¸¦ä¿®è«é˜Ÿ" class="headerlink" title="å¸¦ä¿®è«é˜Ÿ"></a>å¸¦ä¿®è«é˜Ÿ</h3><ul><li>åŠ å…¥æ—¶é—´æˆ³ï¼Œå¯ä»¥åšåˆ°å•ç‚¹ä¿®æ”¹</li></ul><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N = 1e6 + 100;
int a[N], cnt[N], ans[N], bel[N];
struct Query&#123;
    int l, r, time, id;
&#125;q[N];
struct Modify&#123;
    int pos, color, last;
&#125;c[N];
int sz;
bool cmp(Query a, Query b)&#123;
    if(bel[a.l] ^ bel[b.l])&#123;
        return bel[a.l] &lt; bel[b.l];
    &#125;else&#123;
        if(bel[a.r] ^ bel[b.r])&#123;
            return bel[a.r] &lt; bel[b.r];
        &#125;else&#123;
            return a.time &lt; b.time;
        &#125;
    &#125;
&#125;
inline int read()&#123;
    int x = 0, f = 1;
    char ch = getchar();
    while(!isdigit(ch))&#123;
        if(ch == &#39;-&#39;) f = -1;
        ch = getchar();
    &#125;
    while(isdigit(ch))&#123;
        x = x * 10 + ch - &#39;0&#39;;
        ch = getchar();
    &#125;
    return x * f;
&#125;
int cntq, cntc, cur;
inline void add1(int p)&#123;
    if(cnt[a[p]] == 0)&#123;
        cur++;
    &#125;
    cnt[a[p]]++;
&#125;
inline void del1(int p)&#123;
    cnt[a[p]]--;
    if(cnt[a[p]] == 0)&#123;
        cur--;
    &#125;
&#125;
int main()&#123;
    int n = read(), m = read();
    sz = pow(n, 2.0 / 3.0);
    int bnum = ceil((double)n / sz);
    for(int i = 1; i &lt;= bnum; ++i)&#123;
        for(int j = (i - 1) * sz + 1; j &lt;= i * sz; ++j)&#123;
            bel[j] = i;
        &#125;
    &#125;
    for(int i = 1; i &lt;= n; ++i)&#123;
        a[i] = read();
    &#125;
    for(int i = 1; i &lt;= m; ++i)&#123;
        char op[10];
        scanf(&quot;%s&quot;, op);
        if(op[0] == &#39;Q&#39;)&#123;
            q[++cntq].l = read();
            q[cntq].r = read();
            q[cntq].time = cntc;
            q[cntq].id = cntq;
        &#125;else if(op[0] == &#39;R&#39;)&#123;
            c[++cntc].pos = read();
            c[cntc].color = read();
        &#125;
    &#125;
    sort(q + 1, q + cntq + 1, cmp);
    int l = 1, r = 0, ctime = 0;
    for(int i = 1; i &lt;= cntq; ++i)&#123;
        int ql = q[i].l, qr = q[i].r, qtime = q[i].time;
        while(l &lt; ql) del1(l++);
        while(l &gt; ql) add1(--l);
        while(r &lt; qr) add1(++r);
        while(r &gt; qr) del1(r--);
        while(ctime &lt; qtime)&#123;
            ctime++;
            if(ql &lt;= c[ctime].pos &amp;&amp; c[ctime].pos &lt;= qr)&#123;
                cur -= !--cnt[a[c[ctime].pos]] - !cnt[c[ctime].color]++;
            &#125;
            swap(a[c[ctime].pos], c[ctime].color);
        &#125;
        while(qtime &lt; ctime)&#123;
            if(ql &lt;= c[ctime].pos &amp;&amp; c[ctime].pos &lt;= qr)&#123;
                cur -= !--cnt[a[c[ctime].pos]] - !cnt[c[ctime].color]++;
            &#125;
            swap(a[c[ctime].pos], c[ctime].color);
            ctime--;
        &#125;
        ans[q[i].id] = cur;
    &#125;
    for(int i = 1; i &lt;= cntq; ++i)&#123;
        printf(&quot;%d\n&quot;, ans[i]);
    &#125;
&#125;
</code></pre><h2 id="ç‚æœµè‰æ ‘"><a href="#ç‚æœµè‰æ ‘" class="headerlink" title="ç‚æœµè‰æ ‘"></a>ç‚æœµè‰æ ‘</h2><ul><li>ä¼˜é›…çš„æš´åŠ›</li><li>ç‚æœµè‰æ ‘çš„é€‚ç”¨èŒƒå›´æ˜¯æœ‰<strong>åŒºé—´èµ‹å€¼</strong>æ“ä½œä¸”<strong>æ•°æ®éšæœº</strong>çš„é¢˜ç›®ã€‚å…¶å®ç‚æœµè‰æ ‘çœ‹ä¸Šå»å¹¶ä¸åƒæ˜¯æ ‘çŠ¶æ•°æ®ç»“æ„ï¼Œä½†å› ä¸ºä¸€èˆ¬è¦ç”¨åˆ°<code>std::set</code>ï¼Œè€Œ<code>std::set</code>æ˜¯ç”¨çº¢é»‘æ ‘å®ç°çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸ç®—åä¸å‰¯å®ã€‚åœ¨éšæœºæ•°æ®ä¸‹ï¼Œç‚æœµè‰æ ‘å¯ä»¥è¾¾åˆ°Â $O(n;logâ¡;logâ¡;n)$Â çš„å¤æ‚åº¦ï¼ˆå‚è§<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xMDI3ODYwNzE=">è¿™ç¯‡æ–‡ç« </span>ï¼‰ã€‚</li><li>ç‚æœµè‰æ ‘çš„æ€æƒ³åœ¨äºéšæœºæ•°æ®ä¸‹çš„åŒºé—´èµ‹å€¼æ“ä½œå¾ˆå¯èƒ½è®©å¤§é‡å…ƒç´ å˜ä¸ºåŒä¸€ä¸ªæ•°ã€‚æ‰€ä»¥æˆ‘ä»¬ä»¥ä¸‰å…ƒç»„<code>&lt;l,r,v&gt;</code>çš„å½¢å¼ä¿å­˜æ•°æ®ï¼ˆåŒºé—´Â $[l,r]$Â ä¸­çš„å…ƒç´ çš„å€¼éƒ½æ˜¯ $v$ï¼‰ï¼š</li></ul><h3 id="CF896C-Willem-Chtholly-and-Seniorious"><a href="#CF896C-Willem-Chtholly-and-Seniorious" class="headerlink" title="CF896C | Willem, Chtholly and Seniorious"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cubHVvZ3UuY29tLmNuL3Byb2JsZW0vQ0Y4OTZD">CF896C | Willem, Chtholly and Seniorious</span></h3><pre><code class="cpp">// ç‚æœµè‰æ ‘
#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;

struct Node&#123;
    LL l, r;
    mutable LL v;
    Node(LL l, LL r, LL v) : l(l), r(r), v(v) &#123;&#125;
    bool operator &lt; (const Node &amp;rhs) const&#123;
        return l &lt; rhs.l;
    &#125;
&#125;;

LL qpow(LL a, LL b, LL mod)&#123;
    LL ans = 1;
    a %= mod;
    while(b)&#123;
        if(b &amp; 1) ans = ans * a % mod;
        a = a * a % mod;
        b &gt;&gt;= 1;
    &#125;
    return ans;
&#125;

set&lt;Node&gt; tr;
// åˆ†è£‚åŒºé—´
auto split(LL pos)&#123;
    auto it = tr.lower_bound(Node(pos, 0, 0));
    if(it != tr.end() &amp;&amp; it-&gt;l == pos)&#123;
        return it;
    &#125;
    it--;
    auto [l, r, v] = *it;
    tr.erase(it);
    tr.insert(&#123;l, pos - 1, v&#125;);
    return tr.insert(&#123;pos, r, v&#125;).first;
&#125;
// èµ‹å€¼
void assign(LL l, LL r, LL v)&#123;
    // å¼ºè°ƒé¡ºåº
    auto end = split(r + 1), begin = split(l);
    tr.erase(begin, end);
    tr.insert(&#123;l, r, v&#125;);
&#125;
// åŒºé—´åŠ 
void add(LL l, LL r, LL v)&#123;
    auto end = split(r + 1), begin = split(l);
    for(auto it = begin; it != end; it++)&#123;
        it-&gt;v += v;
    &#125;
&#125;
// æ±‚åŒºé—´ k å¤§å€¼
LL kth(LL l, LL r, LL k)&#123;
    auto end = split(r + 1), begin = split(l);
    // pair å­˜èŠ‚ç‚¹çš„å€¼å’ŒåŒºé—´é•¿åº¦
    vector&lt;pair&lt;LL, LL&gt;&gt; v;
    for(auto it = begin; it != end; it++)&#123;
        v.push_back(&#123;it-&gt;v, it-&gt;r - it-&gt;l + 1&#125;);
    &#125;
    sort(v.begin(), v.end());
    for(int i = 0; i &lt; v.size(); i++)&#123;
        k -= v[i].second;
        if(k &lt;= 0) return v[i].first;
    &#125;
&#125;
// æ±‚åŒºé—´ n æ¬¡æ–¹å’Œ
LL sum_of_power(LL l, LL r, LL x, LL y)&#123;
    LL tot = 0;
    auto end = split(r + 1), begin = split(l);
    for(auto it = begin; it != end; it++)&#123;
        tot = (tot + qpow(it-&gt;v, x, y) * (it-&gt;r - it-&gt;l + 1)) % y;
    &#125;
    return tot;
&#125;
LL rnd(LL&amp; seed)&#123;
    LL x = seed;
    seed = (seed * 7 + 13) % 1000000007;
    return x;
&#125;
int main()&#123;
    cin.tie(0)-&gt;sync_with_stdio(false);
    LL n, m, seed, vmax;
    cin &gt;&gt; n &gt;&gt; m &gt;&gt; seed &gt;&gt; vmax;
    for(int i = 1; i &lt;= n; i++)&#123;
        LL r = rnd(seed);
        tr.insert(&#123;i, i, r % vmax + 1&#125;);
    &#125;
    for(int i = 1; i &lt;= m; i++)&#123;
        LL opr = rnd(seed) % 4 + 1, l = rnd(seed) % n + 1, r = rnd(seed) % n + 1, x, y;
        if(l &gt; r)&#123;
            swap(l, r);
        &#125;
        if(opr == 3)&#123;
            x = rnd(seed) % (r - l + 1) + 1;
        &#125;else&#123;
            x = rnd(seed) % vmax + 1;
        &#125;
        if(opr == 4)&#123;
            y = rnd(seed) % vmax + 1;
        &#125;
        switch (opr)
        &#123;
        case 1:
            add(l, r, x);
            break;
        
        case 2:
            assign(l, r, x);
            break;

        case 3:
            cout &lt;&lt; kth(l, r, x) &lt;&lt; &#39;\n&#39;;
            break;

        case 4:
            cout &lt;&lt; sum_of_power(l, r, x, y) &lt;&lt; &#39;\n&#39;;
            break;
        &#125;
    &#125;
&#125;
</code></pre><h2 id="æ ‘é“¾å‰–åˆ†"><a href="#æ ‘é“¾å‰–åˆ†" class="headerlink" title="æ ‘é“¾å‰–åˆ†"></a>æ ‘é“¾å‰–åˆ†</h2><ul><li><p>æ ‘é“¾å‰–åˆ†ç”¨äºå°†æ ‘åˆ†å‰²æˆè‹¥å¹²æ¡é“¾çš„å½¢å¼ï¼Œä»¥ç»´æŠ¤æ ‘ä¸Šè·¯å¾„çš„ä¿¡æ¯ã€‚</p></li><li><p>å…·ä½“æ¥è¯´ï¼Œå°†æ•´æ£µæ ‘å‰–åˆ†ä¸ºè‹¥å¹²æ¡é“¾ï¼Œä½¿å®ƒç»„åˆæˆçº¿æ€§ç»“æ„ï¼Œç„¶åç”¨å…¶ä»–çš„æ•°æ®ç»“æ„ç»´æŠ¤ä¿¡æ¯ã€‚</p></li><li><p><strong>æ ‘é“¾å‰–åˆ†</strong>ï¼ˆæ ‘å‰–&#x2F;é“¾å‰–ï¼‰æœ‰å¤šç§å½¢å¼ï¼Œå¦‚Â <strong>é‡é“¾å‰–åˆ†</strong>ï¼Œ<strong>é•¿é“¾å‰–åˆ†</strong>Â å’Œç”¨äº Link&#x2F;cut Tree çš„å‰–åˆ†ï¼ˆæœ‰æ—¶è¢«ç§°ä½œâ€œå®é“¾å‰–åˆ†â€ï¼‰ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ˆæ²¡æœ‰ç‰¹åˆ«è¯´æ˜æ—¶ï¼‰ï¼Œâ€œæ ‘é“¾å‰–åˆ†â€éƒ½æŒ‡â€œé‡é“¾å‰–åˆ†â€ã€‚</p></li><li><p>é‡é“¾å‰–åˆ†å¯ä»¥å°†æ ‘ä¸Šçš„ä»»æ„ä¸€æ¡è·¯å¾„åˆ’åˆ†æˆä¸è¶…è¿‡Â Â æ¡è¿ç»­çš„é“¾ï¼Œæ¯æ¡é“¾ä¸Šçš„ç‚¹æ·±åº¦äº’ä¸ç›¸åŒï¼ˆå³æ˜¯è‡ªåº•å‘ä¸Šçš„ä¸€æ¡é“¾ï¼Œé“¾ä¸Šæ‰€æœ‰ç‚¹çš„ LCA ä¸ºé“¾çš„ä¸€ä¸ªç«¯ç‚¹ï¼‰ã€‚</p></li><li><p>é‡é“¾å‰–åˆ†è¿˜èƒ½ä¿è¯åˆ’åˆ†å‡ºçš„æ¯æ¡é“¾ä¸Šçš„èŠ‚ç‚¹ DFS åºè¿ç»­ï¼Œå› æ­¤å¯ä»¥æ–¹ä¾¿åœ°ç”¨ä¸€äº›ç»´æŠ¤åºåˆ—çš„æ•°æ®ç»“æ„ï¼ˆå¦‚çº¿æ®µæ ‘ï¼‰æ¥ç»´æŠ¤æ ‘ä¸Šè·¯å¾„çš„ä¿¡æ¯ã€‚</p><ol><li>ä¿®æ”¹Â <strong>æ ‘ä¸Šä¸¤ç‚¹ä¹‹é—´çš„è·¯å¾„ä¸Š</strong>Â æ‰€æœ‰ç‚¹çš„å€¼ã€‚</li><li>æŸ¥è¯¢Â <strong>æ ‘ä¸Šä¸¤ç‚¹ä¹‹é—´çš„è·¯å¾„ä¸Š</strong>Â èŠ‚ç‚¹æƒå€¼çš„Â <strong>å’Œ&#x2F;æå€¼&#x2F;å…¶å®ƒï¼ˆåœ¨åºåˆ—ä¸Šå¯ä»¥ç”¨æ•°æ®ç»“æ„ç»´æŠ¤ï¼Œä¾¿äºåˆå¹¶çš„ä¿¡æ¯ï¼‰</strong>ã€‚</li></ol></li><li><p>é™¤äº†é…åˆæ•°æ®ç»“æ„æ¥ç»´æŠ¤æ ‘ä¸Šè·¯å¾„ä¿¡æ¯ï¼Œæ ‘å‰–è¿˜å¯ä»¥ç”¨æ¥Â ï¼ˆä¸”å¸¸æ•°è¾ƒå°ï¼‰åœ°æ±‚ LCAã€‚åœ¨æŸäº›é¢˜ç›®ä¸­ï¼Œè¿˜å¯ä»¥åˆ©ç”¨å…¶æ€§è´¨æ¥çµæ´»åœ°è¿ç”¨æ ‘å‰–ã€‚</p></li></ul><h3 id="é‡é“¾å‰–åˆ†"><a href="#é‡é“¾å‰–åˆ†" class="headerlink" title="é‡é“¾å‰–åˆ†"></a>é‡é“¾å‰–åˆ†</h3><ul><li>å®šä¹‰Â <strong>é‡å­èŠ‚ç‚¹</strong>Â è¡¨ç¤ºå…¶å­èŠ‚ç‚¹ä¸­å­æ ‘æœ€å¤§çš„å­ç»“ç‚¹ã€‚å¦‚æœæœ‰å¤šä¸ªå­æ ‘æœ€å¤§çš„å­ç»“ç‚¹ï¼Œå–å…¶ä¸€ã€‚å¦‚æœæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œå°±æ— é‡å­èŠ‚ç‚¹ã€‚</li><li>å®šä¹‰Â <strong>è½»å­èŠ‚ç‚¹</strong>Â è¡¨ç¤ºå‰©ä½™çš„æ‰€æœ‰å­ç»“ç‚¹ã€‚ä»è¿™ä¸ªç»“ç‚¹åˆ°é‡å­èŠ‚ç‚¹çš„è¾¹ä¸ºÂ <strong>é‡è¾¹</strong>ï¼Œåˆ°å…¶ä»–è½»å­èŠ‚ç‚¹çš„è¾¹ä¸ºÂ <strong>è½»è¾¹</strong>ã€‚</li><li>è‹¥å¹²æ¡é¦–å°¾è¡”æ¥çš„é‡è¾¹æ„æˆÂ <strong>é‡é“¾</strong>ã€‚</li><li>æŠŠè½å•çš„ç»“ç‚¹ä¹Ÿå½“ä½œé‡é“¾ï¼Œé‚£ä¹ˆæ•´æ£µæ ‘å°±è¢«å‰–åˆ†æˆè‹¥å¹²æ¡é‡é“¾ã€‚</li><li>é‡é“¾å‰–åˆ†æœ‰ä¸€ä¸ªé‡è¦çš„æ€§è´¨ï¼š<strong>å¯¹äºèŠ‚ç‚¹æ•°ä¸ºÂ nÂ çš„æ ‘ï¼Œä»ä»»æ„èŠ‚ç‚¹å‘ä¸Šèµ°åˆ°æ ¹èŠ‚ç‚¹ï¼Œç»è¿‡çš„è½»è¾¹æ•°é‡ä¸è¶…è¿‡Â logâ¡n</strong>Â ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹è¿å‘çˆ¶èŠ‚ç‚¹çš„è¾¹æ˜¯è½»è¾¹ï¼Œå°±å¿…ç„¶å­˜åœ¨å­æ ‘ä¸å°äºå®ƒçš„å…„å¼ŸèŠ‚ç‚¹ï¼Œé‚£ä¹ˆçˆ¶èŠ‚ç‚¹å¯¹åº”å­æ ‘çš„å¤§å°ä¸€å®šè¶…è¿‡è¯¥èŠ‚ç‚¹çš„ä¸¤å€ã€‚æ¯ç»è¿‡ä¸€æ¡è½»è¾¹ï¼Œå­æ ‘å¤§å°å°±ç¿»å€ï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½ç»è¿‡Â logâ¡nÂ æ¡ã€‚</li><li>æˆ‘ä»¬é€šè¿‡ä¸¤æ¬¡dfsæ¥è¿›è¡Œé‡é“¾å‰–åˆ†ã€‚ç¬¬ä¸€è¶Ÿdfsï¼Œå…ˆå¾—åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„<code>fa</code>ï¼ˆçˆ¶èŠ‚ç‚¹ï¼‰ã€<code>sz</code>ï¼ˆå­æ ‘å¤§å°ï¼‰ã€<code>dep</code>ï¼ˆæ·±åº¦ï¼‰ã€<code>hson</code>ï¼ˆé‡å­èŠ‚ç‚¹ï¼‰ï¼š</li></ul><pre><code class="cpp">int fa[N], dep[N], sz[N], hson[N], top[N], dfsn[N], madfsn[N];
void dfs1(int p, int d = 1)&#123;
    int cnt = 1, maxv = 0;
    dep[p] = d;
    for(auto i : g[p])&#123;
        if(!dep[i])&#123;
            dfs1(i, d + 1);
            fa[i] = p;
            cnt += sz[i];
            if(sz[i] &gt; maxv)&#123;
                maxv = sz[i];
                hson[p] = i;
            &#125;
        &#125;
    &#125;
    sz[p] = cnt;
&#125;
</code></pre><ul><li>ç¬¬äºŒè¶Ÿdfsï¼Œå¾—åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„<code>top</code>ï¼ˆé“¾å¤´ï¼Œå³æ‰€åœ¨çš„é‡é“¾ä¸­æ·±åº¦æœ€å°çš„é‚£ä¸ªèŠ‚ç‚¹ï¼‰ï¼š</li></ul><pre><code class="cpp">// éœ€è¦å…ˆæŠŠæ ¹èŠ‚ç‚¹çš„topåˆå§‹åŒ–ä¸ºè‡ªèº«
void dfs2(int p)&#123;
    for(auto i : g[p])&#123;
        if(!top[i])&#123;
            if(i == hson[p])&#123;
                top[i] = top[p];
            &#125;else&#123;
                top[i] = i;
            &#125;
            dfs2(i);
        &#125;
    &#125;
&#125;
</code></pre><h3 id="æ±‚-LCA"><a href="#æ±‚-LCA" class="headerlink" title="æ±‚ LCA"></a>æ±‚ LCA</h3><ul><li>æ ‘å‰–å¯ä»¥å•æ¬¡Â $O(log;â¡n)$Â åœ°æ±‚ LCAï¼Œä¸”å¸¸æ•°è¾ƒå°ã€‚å‡å¦‚æˆ‘ä»¬è¦æ±‚ä¸¤ä¸ªèŠ‚ç‚¹çš„ LCAï¼Œå¦‚æœå®ƒä»¬åœ¨åŒä¸€æ¡é“¾ä¸Šï¼Œé‚£ç›´æ¥è¾“å‡ºæ·±åº¦è¾ƒå°çš„é‚£ä¸ªèŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚</li><li>å¦åˆ™ï¼ŒLCAè¦ä¹ˆåœ¨é“¾å¤´æ·±åº¦è¾ƒå°çš„é‚£æ¡é“¾ä¸Šï¼Œè¦ä¹ˆå°±æ˜¯ä¸¤ä¸ªé“¾å¤´çš„çˆ¶èŠ‚ç‚¹çš„LCAï¼Œä½†ç»ä¸å¯èƒ½åœ¨é“¾å¤´æ·±åº¦è¾ƒå¤§çš„é‚£æ¡é“¾ä¸Šã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠé“¾å¤´æ·±åº¦è¾ƒå¤§çš„èŠ‚ç‚¹ç”¨å…¶é“¾å¤´çš„çˆ¶èŠ‚ç‚¹ä»£æ›¿ï¼Œç„¶åç»§ç»­æ±‚å®ƒä¸å¦ä¸€è€…çš„LCAã€‚</li><li>ç”±äºåœ¨é“¾ä¸Šæˆ‘ä»¬å¯ä»¥Â $O(1)$ åœ°è·³è½¬ï¼Œæ¯æ¡é“¾é—´ç”±è½»è¾¹è¿æ¥ï¼Œè€Œç»è¿‡è½»è¾¹çš„æ¬¡æ•°åˆä¸è¶…è¿‡Â $log ;n$Â ï¼Œæ‰€ä»¥æˆ‘ä»¬å®ç°äº†Â $O(logâ¡;n)$Â çš„ LCA æŸ¥è¯¢ã€‚</li></ul><pre><code class="cpp">int lca(int a, int b)&#123;
    while (top[a] != top[b])&#123;
        if (dep[top[a]] &gt; dep[top[b]])
            a = fa[top[a]];
        else
            b = fa[top[b]];
    &#125;
    return (dep[a] &gt; dep[b] ? b : a);
&#125;
</code></pre><h3 id="ç»“åˆæ•°æ®ç»“æ„"><a href="#ç»“åˆæ•°æ®ç»“æ„" class="headerlink" title="ç»“åˆæ•°æ®ç»“æ„"></a>ç»“åˆæ•°æ®ç»“æ„</h3><ul><li>åœ¨è¿›è¡Œäº†æ ‘é“¾å‰–åˆ†åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥é…åˆçº¿æ®µæ ‘ç­‰æ•°æ®ç»“æ„ç»´æŠ¤æ ‘ä¸Šçš„ä¿¡æ¯ï¼Œè¿™éœ€è¦æˆ‘ä»¬æ”¹ä¸€ä¸‹ç¬¬äºŒæ¬¡dfsçš„ä»£ç ï¼Œæˆ‘ä»¬ç”¨<code>dfsn</code>æ•°ç»„è®°å½•æ¯ä¸ªç‚¹çš„<strong>dfsåº</strong>ï¼Œç”¨<code>madfsn</code>æ•°ç»„è®°å½•<strong>æ¯æ£µå­æ ‘çš„æœ€å¤§dfsåº</strong>ï¼š</li></ul><pre><code class="cpp">// éœ€è¦å…ˆæŠŠæ ¹èŠ‚ç‚¹çš„topåˆå§‹åŒ–ä¸ºè‡ªèº«
int cnt;
void dfs2(int p)&#123;
    madfsn[p] = dfsn[p] = ++cnt;
    if(hson[p] != 0)&#123;
        top[hson[p]] = top[p];
        dfs2(hson[p]);
        madfsn[p] = max(madfsn[p], madfsn[hson[p]]);
    &#125;
    for(auto i : g[p])&#123;
        if(!top[i])&#123;
            top[i] = i;
            dfs2(i);
            madfsn[p] = max(madfsn[p], madfsn[i]);
        &#125;
    &#125;
&#125;
</code></pre><ul><li>æ³¨æ„åˆ°ï¼Œ<strong>æ¯æ£µå­æ ‘çš„dfsåºéƒ½æ˜¯è¿ç»­çš„ï¼Œä¸”æ ¹èŠ‚ç‚¹dfsåºæœ€å°</strong>ï¼›è€Œä¸”ï¼Œå¦‚æœæˆ‘ä»¬ä¼˜å…ˆéå†é‡å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ<strong>åŒä¸€æ¡é“¾ä¸Šçš„èŠ‚ç‚¹çš„dfsåºä¹Ÿæ˜¯è¿ç»­çš„ï¼Œä¸”é“¾å¤´èŠ‚ç‚¹dfsåºæœ€å°</strong>ã€‚</li><li><img data-src="https://pic4.zhimg.com/80/v2-2f1a4cdb51812c7a4cd7f0ab22b9566f_720w.jpg"></li><li>æ‰€ä»¥å°±å¯ä»¥ç”¨çº¿æ®µæ ‘ç­‰æ•°æ®ç»“æ„ç»´æŠ¤åŒºé—´ä¿¡æ¯ï¼ˆä»¥ç‚¹æƒçš„å’Œä¸ºä¾‹ï¼‰ï¼Œä¾‹å¦‚è·¯å¾„ä¿®æ”¹ï¼ˆç±»ä¼¼äºæ±‚LCAçš„è¿‡ç¨‹ï¼‰ï¼š</li></ul><pre><code class="cpp">// è·¯å¾„ä¿®æ”¹
void update_path(int x, int y, int z)&#123;
    while(top[x] != top[y])&#123;
        if(dep[top[x]] &gt; dep[top[y]])&#123;
            modify(1, dfsn[top[x]], dfsn[x], z);
            x = fa[top[x]];
        &#125;else&#123;
            modify(1, dfsn[top[y]], dfsn[y], z);
            y = fa[top[y]];
        &#125;
    &#125;
    if(dep[x] &gt; dep[y])&#123;
        modify(1, dfsn[top[y]], dfsn[x], z);
    &#125;else&#123;
        modify(1, dfsn[top[x]], dfsn[y], z);
    &#125;
&#125;
// è·¯å¾„æŸ¥è¯¢
int query_path(int x, int y)&#123;
    int ans = 0;
    while(top[x] != top[y])&#123;
        if(dep[top[x]] &gt; dep[top[y]])&#123;
            ans += query(1, dfsn[top[x]], dfsn[x]);
            x = fa[top[x]];
        &#125;else&#123;
            ans += query(1, dfsn[top[y]], dfsn[y]);
            y = fa[top[y]];
        &#125;
    &#125;
    if(dep[x] &gt; dep[y])&#123;
        ans += query(1, dfsn[top[y]], dfsn[x]);
    &#125;else&#123;
        ans += query(1, dfsn[top[x]], dfsn[y]);
    &#125;
    return ans;
&#125;
// å­æ ‘ä¿®æ”¹
void modify_subtree(int x, int z)&#123;
    modify(1, dfsn[x], madfsn[x], z);
&#125;
// å­æ ‘æŸ¥è¯¢
int query_subtree(int x)&#123;
    return query(1, dfsn[x], madfsn[x]);
&#125;
</code></pre><ul><li>éœ€è¦æ³¨æ„ï¼Œå»ºçº¿æ®µæ ‘çš„æ—¶å€™ä¸æ˜¯æŒ‰èŠ‚ç‚¹ç¼–å·å»ºï¼Œè€Œæ˜¯æŒ‰dfsåºå»º</li></ul><pre><code class="cpp">for (int i = 1; i &lt;= n; ++i)
    B[i] = read();
// ...
for (int i = 1; i &lt;= n; ++i)
    A[dfsn[i]] = B[i];
build();
</code></pre><ul><li>å½“ç„¶ï¼Œä¸ä»…å¯ä»¥ç”¨çº¿æ®µæ ‘ç»´æŠ¤ï¼Œæœ‰äº›é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xMDYzNTMwODI=">ç‚æœµè‰æ ‘</span>ç­‰æ•°æ®ç»“æ„ï¼ˆè¦æ±‚æ•°æ®ä¸å¡ç‚æœµè‰æ ‘ï¼Œå¦‚<span class="exturl" data-url="aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzOi8vd3d3Lmx1b2d1LmNvbS5jbi9wcm9ibGVtL1A0MzE1">è¿™é“</span>ï¼‰ã€‚æ­¤å¤–ï¼Œå¦‚æœéœ€è¦ç»´æŠ¤çš„æ˜¯è¾¹æƒè€Œä¸æ˜¯ç‚¹æƒï¼ŒæŠŠæ¯æ¡è¾¹çš„è¾¹æƒä¸‹æ”¾åˆ°æ·±åº¦è¾ƒæ·±çš„é‚£ä¸ªèŠ‚ç‚¹å¤„å³å¯ï¼Œä½†æ˜¯æŸ¥è¯¢ã€ä¿®æ”¹çš„æ—¶å€™è¦æ³¨æ„ç•¥è¿‡æœ€åä¸€ä¸ªç‚¹ã€‚</li></ul><h3 id="P2590-æ ‘çš„ç»Ÿè®¡"><a href="#P2590-æ ‘çš„ç»Ÿè®¡" class="headerlink" title="P2590 æ ‘çš„ç»Ÿè®¡"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cubHVvZ3UuY29tLmNuL3Byb2JsZW0vUDI1OTA=">P2590 æ ‘çš„ç»Ÿè®¡</span></h3><pre><code class="cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
typedef long long LL;
const int N = 3e4 + 10;
struct Node&#123;
    int l, r;
    LL sum, maxv;
&#125;tr[N &lt;&lt; 2];
LL w[N];
void pushup(int u)&#123;
    tr[u].sum = tr[u &lt;&lt; 1].sum + tr[u &lt;&lt; 1 | 1].sum;
    tr[u].maxv = max(tr[u &lt;&lt; 1].maxv, tr[u &lt;&lt; 1 | 1].maxv);
&#125;
void build(int u, int l, int r)&#123;
    tr[u] = &#123;l, r&#125;;
    if(l == r)&#123;
        tr[u].sum = w[l];
        tr[u].maxv = w[l];
        return;
    &#125;
    int mid = (l + r) &gt;&gt; 1;
    build(u &lt;&lt; 1, l, mid);
    build(u &lt;&lt; 1 | 1, mid + 1, r);
    pushup(u);
&#125;
void modify(int u, int l, int r, LL v)&#123;
    if(l == tr[u].l &amp;&amp; r == tr[u].r)&#123;
        tr[u].sum = v;
        tr[u].maxv = v;
        return;
    &#125;
    int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
    if(l &lt;= mid) modify(u &lt;&lt; 1, l, r, v);
    if(r &gt; mid) modify(u &lt;&lt; 1 | 1, l, r, v);
    pushup(u);
&#125;
int query_max(int u, int l, int r)&#123;
    if(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r)&#123;
        return tr[u].maxv;
    &#125;
    int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
    int ans = -0x3f3f3f3f;
    if(l &lt;= mid) ans = max(ans, query_max(u &lt;&lt; 1, l, r));
    if(r &gt; mid) ans = max(ans, query_max(u &lt;&lt; 1 | 1, l, r));
    return ans;
&#125;
int query_sum(int u, int l, int r)&#123;
    if(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r)&#123;
        return tr[u].sum;
    &#125;
    int mid = (tr[u].l + tr[u].r) &gt;&gt; 1;
    int ans = 0;
    if(l &lt;= mid) ans = query_sum(u &lt;&lt; 1, l, r);
    if(r &gt; mid) ans += query_sum(u &lt;&lt; 1 | 1, l, r);
    return ans;
&#125;

// æ ‘é“¾å‰–åˆ†
int h[N], ne[N &lt;&lt; 1], e[N &lt;&lt; 1], idx;
int fa[N], dep[N], sz[N], hson[N], top[N], dfsn[N], madfsn[N];
void add(int a, int b)&#123;
    e[idx] = b, ne[idx] = h[a], h[a] = idx++;
&#125;
void dfs1(int p, int d = 1)&#123;
    int cnt = 1, maxv = 0;
    dep[p] = d;
    for(int i = h[p]; ~i; i = ne[i])&#123;
        int j = e[i];
        if(j == fa[p]) continue;
        if(!dep[j])&#123;
            dfs1(j, d + 1);
            cnt += sz[j];
            fa[j] = p;
            if(sz[j] &gt; maxv) maxv = sz[j], hson[p] = j;
        &#125;
    &#125;
    sz[p] = cnt;
&#125;
int cnt;
void dfs2(int p)&#123;
    madfsn[p] = dfsn[p] = ++cnt;
    if(hson[p] != 0)&#123;
        top[hson[p]] = top[p];
        dfs2(hson[p]);
        madfsn[p] = max(madfsn[p], madfsn[hson[p]]);
    &#125;
    for(int i = h[p]; ~i; i = ne[i])&#123;
        int j = e[i];
        if(j == fa[p] || j == hson[p]) continue;
        if(!top[j])&#123;
            top[j] = j;
            dfs2(j);
            madfsn[p] = max(madfsn[p], madfsn[j]);
        &#125;
    &#125;
&#125;
int query_path_max(int x, int y)&#123;
    int ans = -0x3f3f3f3f;
    while(top[x] != top[y])&#123;
        if(dep[top[x]] &lt; dep[top[y]]) swap(x, y);
        ans = max(ans, query_max(1, dfsn[top[x]], dfsn[x]));
        x = fa[top[x]];
    &#125;
    if(dep[x] &gt; dep[y]) swap(x, y);
    ans = max(ans, query_max(1, dfsn[x], dfsn[y]));
    return ans;
&#125;
int query_path_sum(int x, int y)&#123;
    int ans = 0;
    while(top[x] != top[y])&#123;
        if(dep[top[x]] &lt; dep[top[y]]) swap(x, y);
        ans += query_sum(1, dfsn[top[x]], dfsn[x]);
        x = fa[top[x]];
    &#125;
    if(dep[x] &gt; dep[y]) swap(x, y);
    ans += query_sum(1, dfsn[x], dfsn[y]);
    return ans;
&#125;
int num[N];
int main()&#123;
    cin.tie(0)-&gt;sync_with_stdio(false);
    int n;
    cin &gt;&gt; n;
    memset(h, -1, sizeof h);
    for(int i = 1; i &lt; n; i++)&#123;
        int a, b;
        cin &gt;&gt; a &gt;&gt; b;
        add(a, b);
        add(b, a);
    &#125;
    for(int i = 1; i &lt;= n; i++)&#123;
        cin &gt;&gt; num[i];
    &#125;
    top[1] = 1;
    dfs1(1);
    dfs2(1);
    for(int i = 1; i &lt;= n; i++)&#123;
        w[dfsn[i]] = num[i];
    &#125;
    build(1, 1, n);
    int m;
    cin &gt;&gt; m;
    while(m--)&#123;
        string op;
        int a, b;
        cin &gt;&gt; op &gt;&gt; a &gt;&gt; b;
        if(op[0] == &#39;C&#39;) modify(1, dfsn[a], dfsn[a], b);
        else if(op == &quot;QMAX&quot;)&#123;
            cout &lt;&lt; query_path_max(a, b) &lt;&lt; &#39;\n&#39;;
        &#125;else&#123;
            cout &lt;&lt; query_path_sum(a, b) &lt;&lt; &#39;\n&#39;;
        &#125;
    &#125;
&#125;
</code></pre><div class="tags"><a href="/tags/%E6%A8%A1%E6%9D%BF/" rel="tag"><i class="ic i-tag"></i> æ¨¡æ¿</a> <a href="/tags/%E9%A2%98%E9%9B%86/" rel="tag"><i class="ic i-tag"></i> é¢˜é›†</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-07 09:05:35" itemprop="dateModified" datetime="2022-09-07T09:05:35+08:00">2022-09-07</time> </span><span id="post/é«˜çº§æ•°æ®ç»“æ„é¢˜é›†.html" class="item leancloud_visitors" data-flag-title="é«˜çº§æ•°æ®ç»“æ„é¢˜é›†" title="é˜…è¯»æ¬¡æ•°"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">é˜…è¯»æ¬¡æ•°</span> <span class="leancloud-visitors-count"></span> <span class="text">æ¬¡</span></span></div><div id="copyright"><ul><li class="author"><strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Retsa <i class="ic i-at"><em>@</em></i>Retsa</li><li class="link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="https://asterzc19.github.io/post/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E9%A2%98%E9%9B%86.html" title="é«˜çº§æ•°æ®ç»“æ„é¢˜é›†">https://asterzc19.github.io/post/é«˜çº§æ•°æ®ç»“æ„é¢˜é›†.html</a></li><li class="license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/post/%E5%9B%BE%E8%AE%BA%E9%A2%98%E9%9B%86.html" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s3.bmp.ovh&#x2F;imgs&#x2F;2022&#x2F;09&#x2F;05&#x2F;a67b0e59dd863077.jpg" title="å›¾è®ºé¢˜é›†"><span class="type">ä¸Šä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i></span><h3>å›¾è®ºé¢˜é›†</h3></a></div><div class="item right"><a href="/post/Flyme%E6%9B%B4%E6%96%B0.html" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s3.bmp.ovh&#x2F;imgs&#x2F;2022&#x2F;06&#x2F;25&#x2F;ff62598e6c27ddd4.png" title="Flyme æ›´æ–°æ—¥å¿—"><span class="type">ä¸‹ä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i></span><h3>Flyme æ›´æ–°æ—¥å¿—</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">å¹¶æŸ¥é›†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%BC%E5%AD%90%E6%B8%B8%E6%88%8F"><span class="toc-number">1.1.</span> <span class="toc-text">æ ¼å­æ¸¸æˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E9%85%8D%E8%B4%AD%E4%B9%B0"><span class="toc-number">1.2.</span> <span class="toc-text">æ­é…è´­ä¹°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E8%87%AA%E5%8A%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">ç¨‹åºè‡ªåŠ¨åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%B6%E6%B2%B3%E8%8B%B1%E9%9B%84%E4%BC%A0%E8%AF%B4"><span class="toc-number">1.4.</span> <span class="toc-text">é“¶æ²³è‹±é›„ä¼ è¯´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%87%E5%81%B6%E6%B8%B8%E6%88%8F"><span class="toc-number">1.5.</span> <span class="toc-text">å¥‡å¶æ¸¸æˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E5%9F%9F%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="toc-number">1.5.1.</span> <span class="toc-text">æ‰©å±•åŸŸå¹¶æŸ¥é›†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A6%E8%BE%B9%E6%9D%83%E7%9A%84%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="toc-number">1.5.2.</span> <span class="toc-text">å¸¦è¾¹æƒçš„å¹¶æŸ¥é›†</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84"><span class="toc-number">2.</span> <span class="toc-text">æ ‘çŠ¶æ•°ç»„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A5%BC%E5%85%B0%E5%9B%BE%E8%85%BE"><span class="toc-number">2.1.</span> <span class="toc-text">æ¥¼å…°å›¾è…¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B4%E6%95%B0%E9%97%AE%E9%A2%98-%E2%85%A0"><span class="toc-number">2.2.</span> <span class="toc-text">ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜ â… </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B4%E6%95%B0%E9%97%AE%E9%A2%98-%E2%85%A1-%F0%9F%8C%B8"><span class="toc-number">2.3.</span> <span class="toc-text">ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜ â…¡ ğŸŒ¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%9C%E4%B8%80%E6%A0%B7%E7%9A%84%E7%89%9B-%F0%9F%8C%B8"><span class="toc-number">2.4.</span> <span class="toc-text">è°œä¸€æ ·çš„ç‰› ğŸŒ¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF383C-Propagating-tree"><span class="toc-number">2.5.</span> <span class="toc-text">CF383C | Propagating tree</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-number">3.</span> <span class="toc-text">çº¿æ®µæ ‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%BC%80%E7%82%B9%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-number">3.1.</span> <span class="toc-text">åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E6%95%B0-%F0%9F%8C%B8"><span class="toc-number">3.2.</span> <span class="toc-text">æœ€å¤§æ•° ğŸŒ¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%A0%E8%83%BD%E5%9B%9E%E7%AD%94%E8%BF%99%E4%BA%9B%E9%97%AE%E9%A2%98%E5%90%97-%F0%9F%8C%B8"><span class="toc-number">3.3.</span> <span class="toc-text">ä½ èƒ½å›ç­”è¿™äº›é—®é¢˜å— ğŸŒ¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E9%97%B4%E6%9C%80%E5%A4%A7%E5%85%AC%E7%BA%A6%E6%95%B0-%F0%9F%8C%B8"><span class="toc-number">3.4.</span> <span class="toc-text">åŒºé—´æœ€å¤§å…¬çº¦æ•° ğŸŒ¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B4%E6%95%B0%E9%97%AE%E9%A2%98-%E2%85%A1-%F0%9F%8C%B8-1"><span class="toc-number">3.5.</span> <span class="toc-text">ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜ â…¡ ğŸŒ¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%9A%E7%89%B9%E5%85%B0%E8%92%82%E6%96%AF-%F0%9F%8C%B8%F0%9F%8C%B8"><span class="toc-number">3.6.</span> <span class="toc-text">äºšç‰¹å…°è’‚æ–¯ ğŸŒ¸ğŸŒ¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%B4%E6%8A%A4%E5%BA%8F%E5%88%97-%F0%9F%8C%B8"><span class="toc-number">3.7.</span> <span class="toc-text">ç»´æŠ¤åºåˆ— ğŸŒ¸</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.</span> <span class="toc-text">å¯æŒä¹…åŒ–æ•°æ®ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E5%BC%82%E6%88%96%E5%92%8C-%F0%9F%8C%B8%F0%9F%8C%B8%F0%9F%8C%B8"><span class="toc-number">4.1.</span> <span class="toc-text">æœ€å¤§å¼‚æˆ–å’Œ ğŸŒ¸ğŸŒ¸ğŸŒ¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%ACk%E5%B0%8F%E6%95%B0-%F0%9F%8C%B8%F0%9F%8C%B8%F0%9F%8C%B8"><span class="toc-number">4.2.</span> <span class="toc-text">ç¬¬kå°æ•° ğŸŒ¸ğŸŒ¸ğŸŒ¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.3.</span> <span class="toc-text">å¯æŒä¹…åŒ–çº¿æ®µæ ‘æ¨¡æ¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%BC%80%E7%82%B9%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-number">4.4.</span> <span class="toc-text">åŠ¨æ€å¼€ç‚¹å¯æŒä¹…åŒ–çº¿æ®µæ ‘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Treap-%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="toc-number">5.</span> <span class="toc-text">Treap - å¹³è¡¡æ ‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AcWing-%E6%99%AE%E9%80%9A%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="toc-number">5.1.</span> <span class="toc-text">AcWing|æ™®é€šå¹³è¡¡æ ‘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Splay-%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="toc-number">6.</span> <span class="toc-text">Splay å¹³è¡¡æ ‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#P3391-%E6%96%87%E8%89%BA%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="toc-number">6.1.</span> <span class="toc-text">P3391 | æ–‡è‰ºå¹³è¡¡æ ‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P3369-%E6%99%AE%E9%80%9A%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="toc-number">6.2.</span> <span class="toc-text">P3369 | æ™®é€šå¹³è¡¡æ ‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POJ2828-Buy-Tickets"><span class="toc-number">6.3.</span> <span class="toc-text">POJ2828 | Buy Tickets</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%AB%E9%98%9F"><span class="toc-number">7.</span> <span class="toc-text">è«é˜Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E8%8E%AB%E9%98%9F"><span class="toc-number">7.1.</span> <span class="toc-text">æ™®é€šè«é˜Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E4%BF%AE%E8%8E%AB%E9%98%9F"><span class="toc-number">7.2.</span> <span class="toc-text">å¸¦ä¿®è«é˜Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8F%82%E6%9C%B5%E8%8E%89%E6%A0%91"><span class="toc-number">8.</span> <span class="toc-text">ç‚æœµè‰æ ‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CF896C-Willem-Chtholly-and-Seniorious"><span class="toc-number">8.1.</span> <span class="toc-text">CF896C | Willem, Chtholly and Seniorious</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86"><span class="toc-number">9.</span> <span class="toc-text">æ ‘é“¾å‰–åˆ†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E9%93%BE%E5%89%96%E5%88%86"><span class="toc-number">9.1.</span> <span class="toc-text">é‡é“¾å‰–åˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%82-LCA"><span class="toc-number">9.2.</span> <span class="toc-text">æ±‚ LCA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E5%90%88%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">9.3.</span> <span class="toc-text">ç»“åˆæ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P2590-%E6%A0%91%E7%9A%84%E7%BB%9F%E8%AE%A1"><span class="toc-number">9.4.</span> <span class="toc-text">P2590 æ ‘çš„ç»Ÿè®¡</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« "></div><div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Retsa" data-src="/images/iOS.jpg"><p class="name" itemprop="name">Retsa</p><div class="description" itemprop="description">å¯¹æœªæ¥çš„é€æ”¯ï¼Œå¯¹è¿‡å»çš„å¿è¿˜</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">16</span> <span class="name">æ–‡ç« </span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span> <span class="name">åˆ†ç±»</span></a></div><div class="item tags"><a href="/tags/"><span class="count">9</span> <span class="name">æ ‡ç­¾</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FzdGVyWkMxOQ==" title="https:&#x2F;&#x2F;github.com&#x2F;AsterZC19"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9Bc3RlclpDMTk=" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;AsterZC19"><i class="ic i-zhihu"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a></li><li class="item"><a href="/about" rel="section"><i class="ic i-user"></i>å…³äº</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/post/%E5%9B%BE%E8%AE%BA%E9%A2%98%E9%9B%86.html" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/post/Flyme%E6%9B%B4%E6%96%B0.html" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>éšæœºæ–‡ç« </h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="åˆ†ç±»äº ç®—æ³•">ç®—æ³•</a></div><span><a href="/post/STL%E7%AE%80%E4%BB%8B.html" title="STL ç®€ä»‹">STL ç®€ä»‹</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/AcWing/" title="åˆ†ç±»äº AcWing">AcWing</a></div><span><a href="/post/%E7%BA%BF%E6%80%A7%E5%90%8C%E4%BD%99%E6%96%B9%E7%A8%8B.html" title="çº¿æ€§åŒä½™æ–¹ç¨‹">çº¿æ€§åŒä½™æ–¹ç¨‹</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/post/%E7%BD%91%E7%BB%9C%E6%B5%81.html" title="ç½‘ç»œæµ">ç½‘ç»œæµ</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/post/%E5%9B%BE%E8%AE%BA%E9%A2%98%E9%9B%86.html" title="å›¾è®ºé¢˜é›†">å›¾è®ºé¢˜é›†</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="åˆ†ç±»äº ç®—æ³•">ç®—æ³•</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="åˆ†ç±»äº æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</a></div><span><a href="/post/%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%A8%A1%E6%9D%BF.html" title="åŸºç¡€æ•°æ®ç»“æ„æ¨¡æ¿">åŸºç¡€æ•°æ®ç»“æ„æ¨¡æ¿</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%96%87%E7%AB%A0/" title="åˆ†ç±»äº æ–‡ç« ">æ–‡ç« </a></div><span><a href="/post/%E6%B3%A8%E6%84%8F%E5%8A%9B%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%AE%8C%E5%85%A8%E6%8A%A5%E5%91%8A.html" title="æ³¨æ„åŠ›ä½¿ç”¨ä¸å®Œå…¨æŠ¥å‘Š">æ³¨æ„åŠ›ä½¿ç”¨ä¸å®Œå…¨æŠ¥å‘Š</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/post/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E9%A2%98%E9%9B%86.html" title="åŠ¨æ€è§„åˆ’é¢˜é›†">åŠ¨æ€è§„åˆ’é¢˜é›†</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="åˆ†ç±»äº ç®—æ³•">ç®—æ³•</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="åˆ†ç±»äº æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</a></div><span><a href="/post/%E6%90%9C%E7%B4%A2%E4%B8%8E%E5%9B%BE%E8%AE%BA.html" title="æœç´¢ä¸å›¾è®ºæ¨¡æ¿">æœç´¢ä¸å›¾è®ºæ¨¡æ¿</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="åˆ†ç±»äº ç®—æ³•">ç®—æ³•</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="åˆ†ç±»äº æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</a> <i class="ic i-angle-right"></i> <a href="/categories/CodeForces/" title="åˆ†ç±»äº CodeForces">CodeForces</a> <i class="ic i-angle-right"></i> <a href="/categories/AtCoder/" title="åˆ†ç±»äº AtCoder">AtCoder</a></div><span><a href="/post/%E4%B8%AA%E4%BA%BA%E9%A2%98%E5%8D%95.html" title="é¢˜ç›®å°é›†">é¢˜ç›®å°é›†</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/post/Flyme%E6%9B%B4%E6%96%B0.html" title="Flyme æ›´æ–°æ—¥å¿—">Flyme æ›´æ–°æ—¥å¿—</a></span></li></ul></div><div><h2>æœ€æ–°è¯„è®º</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-Retsa"></i> </span><span class="author" itemprop="copyrightHolder">Retsa @ å›ä¸åˆ°çš„è¿‡å»</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="ç«™ç‚¹æ€»å­—æ•°">292k å­—</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">4:26</span></div><div class="powered-by">åŸºäº <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"post/é«˜çº§æ•°æ®ç»“æ„é¢˜é›†.html",favicon:{show:"å—¨~",hide:"å‘œå‘œå‘œ"},search:{placeholder:"æ–‡ç« æœç´¢",empty:"å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",stats:"${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'å¤åˆ¶æˆåŠŸï¼Œè½¬è½½è¯·éµå®ˆ <i class="ic i-creative-commons"></i>BY-NC-SA åè®®ã€‚',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->